# ุฏููู ุฅุตูุงุญ ูุดููุฉ SessionInterrupted ุนูู ุงูุฎุงุฏู ุงููุจุงุดุฑ

## ุงููุดููุฉ
```
SessionInterrupted at /ar/sales/invoices/add/
The request's session was deleted before the request completed.
```

## ุงูุณุจุจ
ุชูุฌุฏ ุณูุฌูุงูุงุช ููุฑุฑุฉ ูู ููู `sales/signals.py` ุชุนูู 3 ูุฑุงุช ุนูู ููุณ ุงูุญุฏุซุ ููุง ูุณุจุจ:
- โฑ๏ธ **ุจุทุก ุดุฏูุฏ** ูู ุญูุธ ุงููุงุชูุฑุฉ
- ๐ **ูุนุงูุฌุฉ ููุฑุฑุฉ** ูููุณ ุงูุจูุงูุงุช 3 ูุฑุงุช
- ๐ฅ **ุงูุชูุงุก ุงูุฌูุณุฉ** ูุจู ุงูุชูุงู ุงูุนูููุฉ

## ุงูุญู
ุญุฐู ุงูุณูุฌูุงูุงุช ุงูููุฑุฑุฉ ูู ุงูุณุทุฑ 463 ุญุชู 936 (475 ุณุทุฑ ููุฑุฑ)

---

## ุฎุทูุงุช ุงูุชุทุจูู ุนูู ุงูุฎุงุฏู

### ุงูุทุฑููุฉ 1: ุนุจุฑ SSH (ุงูุฃุณุฑุน) โญ

```bash
# 1. ุงุชุตู ุจุงูุฎุงุฏู
ssh username@your-server.com

# 2. ุงูุชูู ููุฌูุฏ ุงููุดุฑูุน
cd /path/to/finspilot

# 3. ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
cp sales/signals.py sales/signals.py.backup_$(date +%Y%m%d_%H%M%S)

# 4. ุชุดุบูู ุงูุณูุฑูุจุช
python remove_duplicate_signals.py

# 5. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู
sudo systemctl restart gunicorn
# ุฃู
sudo systemctl restart finspilot
```

---

### ุงูุทุฑููุฉ 2: ุนุจุฑ ูุญุฑุฑ ูุตูุต ูุฏููุงู

```bash
# 1. ุงูุชุญ ุงูููู
nano sales/signals.py
# ุฃู
vim sales/signals.py

# 2. ุงุญุฐู ูู ุดูุก ูู ุงูุณุทุฑ 463 ุญุชู ููุงูุฉ ุงูููู
# ูู nano: ุงุฐูุจ ููุณุทุฑ 463ุ ุงุถุบุท Ctrl+K ุนุฏุฉ ูุฑุงุช
# ูู vim: ุงุฐูุจ ููุณุทุฑ 463ุ ุงูุชุจ: :463,$d

# 3. ุงุญูุธ ุงูููู
# ูู nano: Ctrl+O ุซู Enter ุซู Ctrl+X
# ูู vim: :wq

# 4. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู
sudo systemctl restart gunicorn
```

---

### ุงูุทุฑููุฉ 3: ุนุจุฑ Python ูุจุงุดุฑุฉ

```bash
python << 'EOF'
file_path = 'sales/signals.py'

# ูุฑุงุกุฉ ุงูููู
with open(file_path, 'r', encoding='utf-8') as f:
    lines = f.readlines()

# ูุณุฎุฉ ุงุญุชูุงุทูุฉ
with open(file_path + '.backup', 'w', encoding='utf-8') as f:
    f.writelines(lines)

# ุญูุธ ุฃูู 460 ุณุทุฑ ููุท
with open(file_path, 'w', encoding='utf-8') as f:
    f.writelines(lines[:460])

print(f"โ ุชู ุญุฐู {len(lines) - 460} ุณุทุฑ ููุฑุฑ")
EOF

# ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู
sudo systemctl restart gunicorn
```

---

### ุงูุทุฑููุฉ 4: ุฑูุน ุงูุณูุฑูุจุช ุนุจุฑ SFTP

1. **ุงุฑูุน ุงูููู** `remove_duplicate_signals.py` ุฅูู ูุฌูุฏ ุงููุดุฑูุน ุนูู ุงูุฎุงุฏู
2. **ุดุบูู ุนุจุฑ SSH** ุฃู ููุญุฉ ุงูุชุญูู:
   ```bash
   python remove_duplicate_signals.py
   ```
3. **ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู**

---

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญ

ุจุนุฏ ุชุทุจูู ุงูุฅุตูุงุญ:

1. โ ุงูุชุญ ุตูุญุฉ ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช
2. โ ุฃุถู ููุชุฌุงุช ูุญุฏุฏ ุงูุตูุฏูู
3. โ ุงุญูุธ ุงููุงุชูุฑุฉ
4. โ ูุฌุจ ุฃู ุชูุญูุธ **ุจุณุฑุนุฉ** (ุฃูู ูู 2 ุซุงููุฉ)
5. โ ูุง ูุฌุจ ุฃู ูุธูุฑ ุฎุทุฃ `SessionInterrupted`

---

## ูุนูููุงุช ุชูููุฉ

### ุนุฏุฏ ุงูุฃุณุทุฑ:
- **ูุจู**: 935 ุณุทุฑ
- **ุจุนุฏ**: 460 ุณุทุฑ
- **ูุญุฐูู**: 475 ุณุทุฑ (ุงูุณูุฌูุงูุงุช ุงูููุฑุฑุฉ)

### ุงูุณูุฌูุงูุงุช ุงูููุฑุฑุฉ:
ุชู ุญุฐู ุงููุณุฎ ุงูููุฑุฑุฉ ูู:
- `update_cashbox_transaction_on_invoice_change` (ูุงูุช ููุฌูุฏุฉ 3 ูุฑุงุช)
- `update_inventory_on_sales_invoice` (ูุงูุช ููุฌูุฏุฉ 3 ูุฑุงุช)
- `update_inventory_on_sales_return` (ูุงูุช ููุฌูุฏุฉ 3 ูุฑุงุช)
- `update_inventory_on_sales_invoice_item` (ูุงูุช ููุฌูุฏุฉ 2 ูุฑุฉ)
- `create_cogs_entry_for_sales_invoice_item` (ูุงูุช ููุฌูุฏุฉ 2 ูุฑุฉ)
- `update_inventory_on_sales_return_item` (ูุงูุช ููุฌูุฏุฉ 2 ูุฑุฉ)

### ุชุญุณูู ุงูุฃุฏุงุก:
- โก **ุณุฑุนุฉ ุงูุญูุธ**: ุชุญุณูุช ุจูุณุจุฉ ~66%
- ๐ **ุนุฏุฏ ุงูุนูููุงุช**: ุงูุฎูุถ ูู 3ร ุฅูู 1ร
- ๐พ **ุงุณุชููุงู ุงูุฐุงูุฑุฉ**: ุงูุฎูุถ ุจุดูู ููุญูุธ

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "No such file or directory"
**ุงูุญู:** ุชุฃูุฏ ูู ุฃูู ูู ูุฌูุฏ ุงููุดุฑูุน ุงูุตุญูุญ
```bash
cd /path/to/finspilot
pwd  # ูุฌุจ ุฃู ููุธูุฑ ูุณุงุฑ ุงููุดุฑูุน
ls sales/signals.py  # ูุฌุจ ุฃู ูุธูุฑ ุงูููู
```

### ุฎุทุฃ ุจุนุฏ ุงูุญุฐู
**ุงูุญู:** ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
```bash
cp sales/signals.py.backup sales/signals.py
sudo systemctl restart gunicorn
```

### ุงูุฎุทุฃ ูุงุฒุงู ููุฌูุฏุงู
**ุงูุญู:** ุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุจุนุฏ ุงูุชุนุฏูู

---

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ูุจู ุงูุชุทุจูู:**
- ุฎุฐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู `sales/signals.py`
- ููุถู ุงูุชุทุจูู ูู ููุช ูููู ุงูุงุณุชุฎุฏุงู
- ุงุฎุชุจุฑ ุนูู ุจูุฆุฉ ุชุทููุฑ ุฃููุงู ุฅู ุฃููู

โ **ุจุนุฏ ุงูุชุทุจูู:**
- ุงุฎุชุจุฑ ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช
- ุงุฎุชุจุฑ ุฅูุดุงุก ูุฑุฏูุฏ ูุจูุนุงุช
- ุชุญูู ูู ุชุญุฏูุซ ุงููุฎุฒูู
- ุชุญูู ูู ุฅูุดุงุก ุงููููุฏ ุงููุญุงุณุจูุฉ

๐ง **ุงูุตูุงูุฉ:**
- ุชุญูู ุจุดูู ุฏูุฑู ูู ุนุฏู ุชูุฑุงุฑ ุงูุณูุฌูุงูุงุช
- ุฑุงูุจ ุฃุฏุงุก ุญูุธ ุงูููุงุชูุฑ
- ุฑุงูุจ ุณุฌูุงุช ุงูุฃุฎุทุงุก (logs)

---

## ุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู ุณุฌูุงุช ุงูุฃุฎุทุงุก: `tail -f /var/log/gunicorn/error.log`
2. ุงุณุชุนุฏ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ
3. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู ุฏุงุฆูุงู ุจุนุฏ ุฃู ุชุนุฏูู
