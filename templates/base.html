{% load i18n %}
{% load custom_i18n %}
{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" {% if LANGUAGE_CODE == 'ar' %}dir="rtl"{% else %}dir="ltr"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% trans "Finspilot - Accounting System" %}{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    {% if LANGUAGE_CODE == 'ar' %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    {% else %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    {% endif %}
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Responsive CSS -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'core/css/responsive.css' %}">
    <link rel="stylesheet" href="{% static 'core/css/table-responsive.css' %}">
    
    <!-- Session Management CSS -->
    {% if user.is_authenticated %}
    <link rel="stylesheet" href="{% static 'core/css/session-management.css' %}">
    {% endif %}
    
    <!-- Session settings for JavaScript -->
    {% if user.is_authenticated %}
        {% load settings_tags %}
        {% get_session_settings as session_settings %}
        <meta name="session-timeout" content="{{ session_settings.timeout_minutes }}">
        <meta name="session-timeout-enabled" content="{{ session_settings.enable_timeout|yesno:'true,false' }}">
        <meta name="logout-on-browser-close" content="{{ session_settings.logout_on_browser_close|yesno:'true,false' }}">
    {% endif %}
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        /* Print CSS */
        @media print {
            .no-print, .sidebar, .navbar, .btn, .pagination, 
            .dropdown, .modal, .toast, .alert-dismissible .btn-close,
            .print-hide, .search-filters, .filters, .form-control,
            .page-title-right, .card-header .d-flex .btn, .action-buttons,
            .actions-column, .edit-column, .delete-column, .d-none {
                display: none !important;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
                font-size: 8pt;
                line-height: 1.1;
                margin: 0;
                padding: 0;
                font-family: 'Arial', sans-serif;
            }
            
            .container, .container-fluid {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .row {
                margin: 0 !important;
            }
            
            .col, .col-12, [class*="col-"] {
                padding: 0 !important;
                width: 100% !important;
            }
            
            .card {
                border: none !important;
                box-shadow: none !important;
                page-break-inside: avoid;
                margin: 0;
                width: 100%;
            }
            
            .card-header {
                background-color: #f8f9fa !important;
                color: black !important;
                border: 2px solid #000 !important;
                text-align: center;
                padding: 8px 0;
                margin-bottom: 15px;
                font-weight: bold;
                font-size: 12pt;
            }
            
            .card-title, h1, h2, h3, h4, h5, h6, .page-title {
                color: black !important;
                text-align: center;
                font-size: 11pt;
                font-weight: bold;
                margin: 5px 0;
            }
            
            .card-body {
                padding: 0 !important;
            }
            
            /* Improve table display */
            .table-responsive {
                overflow: visible !important;
            }
            
            .table {
                border-collapse: collapse !important;
                width: 100% !important;
                margin: 0 !important;
                font-size: 7pt;
                table-layout: auto;
                border: 2px solid #000 !important;
                background-color: white !important;
            }
            
            .table th, .table td {
                border: 1px solid #000 !important;
                padding: 2px 1px !important;
                text-align: center !important;
                word-wrap: break-word;
                vertical-align: middle;
                font-size: 7pt;
                overflow: visible;
                white-space: normal;
                max-width: none;
            }
            
            .table thead th {
                background-color: #e9ecef !important;
                color: black !important;
                font-weight: bold !important;
                font-size: 8pt;
                border: 2px solid #000 !important;
                text-align: center !important;
            }
            
            .table tbody tr:nth-child(even) {
                background-color: #f8f9fa !important;
            }
            
            .table tbody tr:nth-child(odd) {
                background-color: white !important;
            }
            
            /* Hide actions column and buttons properly */
            .table th:last-child, 
            .table td:last-child,
            .table th:nth-last-child(1),
            .table td:nth-last-child(1),
            .table th:nth-last-child(2),
            .table td:nth-last-child(2),
            .actions-column,
            .action-buttons,
            .btn-group,
            .btn-sm,
            .edit-btn,
            .delete-btn,
            .view-btn,
            .operations-column,
            th:contains("Actions"),
            th:contains("Operations"),
            th:contains("Control"),
            th:contains("Manage") {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Show all important data */
            .table th:not(.actions-column):not([class*="action"]):not([class*="btn"]),
            .table td:not(.actions-column):not([class*="action"]):not([class*="btn"]) {
                display: table-cell !important;
                visibility: visible !important;
            }
            
            /* Improve colored text display */
            .text-primary, .text-success, .text-danger, .text-warning, .text-info, .text-secondary {
                color: black !important;
            }
            
            .badge {
                color: black !important;
                border: 1px solid black !important;
                background-color: white !important;
                font-size: 6pt;
                padding: 1px 3px;
            }
            
            /* Improve financial data display */
            .balance, .amount, .price, .total, .currency {
                font-weight: bold !important;
                text-align: right !important;
                direction: ltr;
            }
            
            /* Enhanced print header */
            .print-header {
                text-align: center;
                margin-bottom: 20px;
                border-bottom: 3px solid #000;
                padding-bottom: 10px;
                background-color: #f8f9fa !important;
                font-size: 14pt;
                font-weight: bold;
            }
            
            .print-date {
                text-align: left;
                margin-bottom: 10px;
                font-size: 7pt;
                border-bottom: 1px solid #666;
                padding-bottom: 3px;
                direction: ltr;
            }
            
            .print-company-info {
                text-align: center;
                margin-bottom: 15px;
                font-size: 10pt;
                font-weight: bold;
                border: 2px solid #000;
                padding: 5px;
                background-color: #f0f0f0 !important;
            }
            
            /* Improve page breaks */
            .page-break {
                page-break-before: always;
            }
            
            @page {
                margin: 0.5cm;
                size: A4 landscape;
            }
            
            /* Prevent breaking rows and important elements */
            .table tr {
                page-break-inside: avoid;
            }
            
            .card {
                page-break-inside: avoid;
            }
            
            /* Advanced page number settings */
            @page {
                margin: 0.5cm;
                size: A4 landscape;
                @bottom-center {
                    content: "Page " counter(page) " of " counter(pages);
                    font-size: 8pt;
                    font-weight: bold;
                }
                @top-center {
                    content: "Print Date: " attr(data-print-date);
                    font-size: 7pt;
                }
            }
            
            /* Improve long data display */
            .long-text {
                white-space: normal !important;
                word-wrap: break-word !important;
                max-width: 100px;
            }
            
            /* Improve dates and numbers display */
            .date-column, .number-column, .id-column {
                white-space: nowrap !important;
                font-family: 'Courier New', monospace;
                font-size: 7pt;
            }
            
            /* Hide unnecessary elements */
            .search-form, .filter-form, .pagination-wrapper,
            .alert, .message, .notification, .tooltip,
            .popover, .modal-backdrop, .offcanvas {
                display: none !important;
            }
            
            /* Improve numeric data display */
            .numeric-data {
                text-align: right !important;
                font-family: 'Courier New', monospace;
                direction: ltr;
            }
        }
        
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            margin: 0.25rem 0;
            transition: all 0.3s ease;
        }
        
        .sidebar .nav-link:hover {
            color: #fff;
            background-color: rgba(255,255,255,0.1);
            transform: translateX(-5px);
        }
        
        .sidebar .nav-link.active {
            color: #fff !important;
            background-color: #007bff !important;
            border-radius: 5px;
            font-weight: bold;
            position: relative;
            border-left: 4px solid #28a745;
        }
        
        .sidebar .nav-link.active::before {
            content: "●";
            color: #28a745;
            font-size: 12px;
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .sidebar .nav-link.active i {
            color: white !important;
        }
        
        /* Highlight main menu containing active page */
        .sidebar .nav-item.has-active-child > a[data-bs-toggle="collapse"] {
            background-color: rgba(0, 123, 255, 0.1);
            border-left: 3px solid #007bff;
            font-weight: bold;
        }
        
        .main-content {
            padding: 2rem;
        }
        
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
        }
        
        .card-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 0.75rem 0.75rem 0 0 !important;
        }
        
        .navbar {
            background: white !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .company-logo {
            opacity: 0.1;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
            max-width: 500px;
            max-height: 500px;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stats-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
            transform: translateY(-1px);
        }
        
        /* Language Selector Styles */
        #languageDropdown {
            color: #495057;
        }
        
        #languageDropdown:hover {
            color: #007bff;
        }
        
        .dropdown-item.active {
            background-color: #f8f9fa;
            color: #007bff;
        }
        
        .dropdown-item button {
            background: none;
            border: none;
            width: 100%;
            text-align: right;
            padding: 0;
            color: inherit;
        }
        
        .dropdown-item:hover button {
            color: inherit;
        }
        
        /* AJAX Loading improvements */
        .main-content {
            min-height: 500px;
            transition: opacity 0.2s ease-in-out;
        }
        
        .sidebar .nav-link.loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* Add effect for active link */
        .sidebar .nav-link.active {
            background-color: rgba(255,255,255,0.2) !important;
            color: #fff !important;
            border-right: 3px solid #fff;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Company Logo Background -->
    {% if company_settings.logo %}
    <img src="{{ company_settings.logo.url }}" class="company-logo" alt="{% trans 'Company Logo' %}">
    {% endif %}
    
    <!-- Top Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="{% url 'core:dashboard' %}">
                <i class="fas fa-chart-line me-2"></i>
                {{ company_settings.company_name }} - {% trans "Dashboard" %}
            </a>
            
            <div class="navbar-nav ms-auto">
                <!-- Language Selector -->
                <div class="nav-item dropdown me-3">
                    <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-globe me-1"></i>
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'ar' %}{% trans "Arabic" %}{% else %}{% trans "English" %}{% endif %}
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <form action="{% url 'set_language' %}" method="post" style="display: inline;" class="language-form" data-target-lang="ar">
                                {% csrf_token %}
                                <input name="next" type="hidden" value="{{ request.get_full_path }}" class="next-field" />
                                <input name="language" type="hidden" value="ar" />
                                <button type="submit" class="dropdown-item {% if LANGUAGE_CODE == 'ar' %}active{% endif %}">
                                    <i class="fas fa-check me-2" {% if LANGUAGE_CODE != 'ar' %}style="visibility: hidden;"{% endif %}></i>
                                    {% trans "Arabic" %}
                                </button>
                            </form>
                        </li>
                        <li>
                            <form action="{% url 'set_language' %}" method="post" style="display: inline;" class="language-form" data-target-lang="en">
                                {% csrf_token %}
                                <input name="next" type="hidden" value="{{ request.get_full_path }}" class="next-field" />
                                <input name="language" type="hidden" value="en" />
                                <button type="submit" class="dropdown-item {% if LANGUAGE_CODE == 'en' %}active{% endif %}">
                                    <i class="fas fa-check me-2" {% if LANGUAGE_CODE != 'en' %}style="visibility: hidden;"{% endif %}></i>
                                    {% trans "English" %}
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
                
                <!-- Notifications -->
                {% if user.is_authenticated %}
                <div class="nav-item dropdown me-3">
                    <a class="nav-link position-relative" href="{% url 'core:notifications' %}" id="notificationDropdown">
                        <i class="fas fa-bell fa-lg"></i>
                        {% if unread_notifications_count > 0 %}
                        <span class="notification-badge">{{ unread_notifications_count }}</span>
                        {% endif %}
                    </a>
                </div>
                
                <!-- User Menu -->
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user me-1"></i>
                        {{ user.get_full_name|default:user.username }}
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'settings:index' %}"><i class="fas fa-cog me-2"></i>{% trans "Settings" %}</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'auth:logout' %}"><i class="fas fa-sign-out-alt me-2"></i>{% trans "Logout" %}</a></li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>
    
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            {% if user.is_authenticated and user.user_type != 'pos_user' %}
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <!-- {% trans "Comprehensive Search" %} -->
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'search:search' %}">
                                <i class="fas fa-search me-2"></i>
                                {% trans "Global Search" %}
                            </a>
                        </li>
                        <!-- Dashboard -->
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:dashboard' %}">
                                <i class="fas fa-home me-2"></i>
                                {% trans "Dashboard" %}
                            </a>
                        </li>                    
                        <!-- Bank Accounts -->
                        {% if user.has_banks_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#banksMenu">
                                <i class="fas fa-university me-2"></i>
                                {% trans "Bank Accounts" %}
                            </a>
                            <div class="collapse" id="banksMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'banks:account_add' %}">{% trans "Add Account" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'banks:account_list' %}">{% trans "Accounts List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'banks:transfer_list' %}">{% trans "Transfers List" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Cashboxes -->
                        {% if user.has_cashboxes_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#cashboxesMenu">
                                <i class="fas fa-cash-register me-2"></i>
                                {% trans "Cash Boxes" %}
                            </a>
                            <div class="collapse" id="cashboxesMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'cashboxes:cashbox_list' %}">{% trans "Cashboxes List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'cashboxes:transfer_list' %}">{% trans "Transfers List" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Payment Receipts -->
                        {% if user.has_receipts_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#receiptsMenu">
                                <i class="fas fa-receipt me-2"></i>
                                {% trans "Payment Receipts" %}
                            </a>
                            <div class="collapse" id="receiptsMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'receipts:receipt_add' %}">{% trans "Add Payment Receipt" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'receipts:receipt_list' %}">{% trans "Receipts List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'receipts:check_list' %}">{% trans "Checks Management" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Payment Vouchers -->
                        {% if user.has_receipts_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#paymentsMenu">
                                <i class="fas fa-money-bill-wave me-2"></i>
                                {% trans "Payment Vouchers" %}
                            </a>
                            <div class="collapse" id="paymentsMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'payments:voucher_create' %}">{% trans "Add Payment Voucher" %}</a>
                                    </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="{% url 'payments:voucher_list' %}">{% trans "Vouchers List" %}</a>
                                        </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Products & Categories -->
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#productsMenu">
                                <i class="fas fa-boxes me-2"></i>
                                {% trans "Categories & Products" %}
                            </a>
                            <div class="collapse" id="productsMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'products:category_add' %}">{% trans "Add Category" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'products:product_add' %}">{% trans "Add Product" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'products:category_list' %}">{% trans "Categories List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'products:product_list' %}">{% trans "Products List" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        
                        <!-- Customers & Suppliers -->
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#customersMenu">
                                <i class="fas fa-users me-2"></i>
                                {% trans "Customers & Suppliers" %}
                            </a>
                            <div class="collapse" id="customersMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'customers:add' %}">{% trans "Add Customer/Supplier" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'customers:customer_list' %}">{% trans "Customers List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'customers:supplier_list' %}">{% trans "Suppliers List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'customers:list' %}">{% trans "All Customers & Suppliers" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        
                        <!-- Purchases -->
                        {% if user.has_purchases_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#purchasesMenu">
                                <i class="fas fa-shopping-cart me-2"></i>
                                {% trans "Purchases" %}
                            </a>
                            <div class="collapse" id="purchasesMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'purchases:invoice_add' %}">{% trans "Create Purchase Invoice" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'purchases:return_add' %}">{% trans "Create Purchase Return" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'purchases:invoice_list' %}">{% trans "Purchase Invoices List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'purchases:return_list' %}">{% trans "Purchase Returns List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'purchases:purchase_statement' %}">{% trans "Purchase Statement" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'purchases:purchase_return_statement' %}">{% trans "Purchase Return Statement" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Sales -->
                        {% if user.has_sales_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#salesMenu">
                                <i class="fas fa-cash-register me-2"></i>
                                {% trans "Sales" %}
                            </a>
                            <div class="collapse" id="salesMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:invoice_add' %}">{% trans "Create Sales Invoice" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:return_add' %}">{% trans "Create Sales Return" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:invoice_list' %}">{% trans "Sales Invoices List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:return_list' %}">{% trans "Sales Returns List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:sales_statement' %}">{% trans "Sales Statement" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:sales_return_statement' %}">{% trans "Sales Returns Statement" %}</a>
                                    </li>
                                    {% if user.has_pos_permission %}
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:pos' %}">{% trans "Point of Sale" %}</a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Inventory -->
                        {% if user.has_inventory_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#inventoryMenu">
                                <i class="fas fa-warehouse me-2"></i>
                                {% trans "Inventory" %}
                            </a>
                            <div class="collapse" id="inventoryMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'inventory:list' %}">{% trans "View Inventory" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'inventory:warehouse_list' %}">{% trans "Warehouses" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'inventory:movement_list' %}">{% trans "Inventory Movement" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'inventory:low_stock' %}">{% trans "Stock Alerts" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Revenues & Expenses -->
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#revenuesExpensesMenu">
                                <i class="fas fa-chart-line me-2"></i>
                                {% trans "Revenues & Expenses" %}
                            </a>
                            <div class="collapse" id="revenuesExpensesMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'revenues_expenses:dashboard' %}">{% trans "Dashboard" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'revenues_expenses:category_list' %}">{% trans "Manage Categories" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'revenues_expenses:entry_list' %}">{% trans "Entries List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'revenues_expenses:entry_create' %}">{% trans "Add New Entry" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'revenues_expenses:recurring_list' %}">{% trans "Recurring Revenue" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        
                        <!-- Journal Entries -->
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#journalMenu">
                                <i class="fas fa-book me-2"></i>
                                {% trans "Journal Entries" %}
                            </a>
                            <div class="collapse" id="journalMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'journal:dashboard' %}">{% trans "Dashboard" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'journal:entry_list' %}">{% trans "All Entries" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'journal:entries_by_type' %}">{% trans "Entries by Type" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'journal:entry_create' %}">{% trans "Create Manual Entry" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'journal:account_list' %}">{% trans "Chart of Accounts" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'journal:trial_balance' %}">{% trans "Trial Balance" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        
                        <!-- Assets & Liabilities -->
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#assetsLiabilitiesMenu">
                                <i class="fas fa-balance-scale me-2"></i>
                                {% trans "Assets & Liabilities" %}
                            </a>
                            <div class="collapse" id="assetsLiabilitiesMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'assets_liabilities:dashboard' %}">{% trans "Dashboard" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'assets_liabilities:asset_list' %}">{% trans "Assets List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'assets_liabilities:liability_list' %}">{% trans "Liabilities List" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>

                        <!-- Reports -->
                        {% if user.has_reports_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#reportsMenu">
                                <i class="fas fa-chart-bar me-2"></i>
                                {% trans "Reports" %}
                            </a>
                            <div class="collapse" id="reportsMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'sales:sales_report' %}">{% trans "Sales Reports" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'purchases:purchase_report' %}">{% trans "Purchase Reports" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'core:tax_report' %}">{% trans "Tax Report" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'core:profit_loss_report' %}">{% trans "Profit and Loss" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- System Management -->
                        {% if user.has_system_management_permission %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" href="#systemMenu">
                                <i class="fas fa-cogs me-2"></i>
                                {% trans "System Management" %}
                            </a>
                            <div class="collapse" id="systemMenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'users:user_add' %}">{% trans "Add User" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'users:user_list' %}">{% trans "Users List" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'users:group_list' %}">{% trans "Groups & Permissions" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'core:audit_log' %}">
                                            <i class="fas fa-history me-2"></i>
                                            {% trans "Activity Log" %}
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'settings:document_sequences' %}">{% trans "Document Number Management" %}</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'settings:company' %}">{% trans "System Settings" %}</a>
                                    </li>
                                    
                                    <!-- System Management - For Super Admin and Admin -->
                                    {% if user.user_type == 'superadmin' or user.user_type == 'admin' or user.is_superuser or user.has_company_settings_permission %}
                                    
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'settings:superadmin_management' %}">
                                            <i class="fas fa-crown me-2 text-warning"></i>
                                            {% trans "System Management" %}
                                            <span class="badge bg-danger ms-1">{% trans "Advanced" %}</span>
                                        </a>
                                    </li>
                                    
                                    <!-- Print Design Settings -->
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'settings:print_design' %}">
                                            <i class="fas fa-paint-brush me-2 text-success"></i>
                                            {% trans "Print Design" %}
                                        </a>
                                    </li>
                                    
                                    <!-- Backup and Restore -->
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'backup:backup_restore' %}">
                                            <i class="fas fa-database me-2 text-info"></i>
                                            {% trans "Backup" %}
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </nav>
            {% endif %}
            
            <!-- Main Content -->
            <main class="{% if user.is_authenticated and user.user_type != 'pos_user' %}col-md-9 ms-sm-auto col-lg-10{% else %}col-12{% endif %} px-md-4">
                <div class="main-content" id="main-content">
                    {% if messages %}
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                    {% endif %}
                    
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // تعطيل التنقل الجزئي (AJAX) افتراضياً لتفادي فقدان الأنماط والسكربتات
        // فعِّله بوضع window.ENABLE_AJAX_NAV = true قبل هذا السكربت إن رغبت.
        if (window.ENABLE_AJAX_NAV !== true) {
            return;
        }
        // Function to determine active page in sidebar
        function setActiveSidebarItem() {
            const currentUrl = window.location.pathname;
            const sidebarLinks = document.querySelectorAll('.sidebar .nav-link[href]');
            
            // Remove active from all links
            sidebarLinks.forEach(link => {
                link.classList.remove('active');
                // Remove has-active-child from other menus
                const parentNavItem = link.closest('.nav-item');
                if (parentNavItem) {
                    parentNavItem.classList.remove('has-active-child');
                }
            });
            
            // Find the link matching the current page
            let activeLink = null;
            let exactMatch = false;
            
            sidebarLinks.forEach(link => {
                const linkPath = new URL(link.href).pathname;
                
                // Exact match
                if (linkPath === currentUrl) {
                    activeLink = link;
                    exactMatch = true;
                }
                // Partial match (if no exact match found)
                else if (!exactMatch && currentUrl.startsWith(linkPath) && linkPath !== '/') {
                    activeLink = link;
                }
            });
            
            // Activate the link
            if (activeLink) {
                activeLink.classList.add('active');
                
                // Find the parent menu and submenu containing this link
                const parentCollapse = activeLink.closest('.collapse');
                if (parentCollapse) {
                    // Open the submenu
                    const bsCollapse = new bootstrap.Collapse(parentCollapse, {show: true});
                    bsCollapse.show();
                    
                    // Highlight the parent menu
                    const mainNavItem = parentCollapse.closest('.nav-item');
                    if (mainNavItem) {
                        mainNavItem.classList.add('has-active-child');
                    }
                    
                    // Save the open menu state
                    localStorage.setItem('sidebar_' + parentCollapse.id, 'open');
                }
            }
        }
        
        // Select the active page on page load
        setActiveSidebarItem();
        
        // Handle clicks on sidebar links
        const sidebarLinks = document.querySelectorAll('.sidebar .nav-link[href]:not([data-bs-toggle])');
        
        sidebarLinks.forEach(link => {
            // Ignore links that open dropdowns or external links
            if (link.getAttribute('data-bs-toggle') === 'collapse' || 
                link.href.startsWith('mailto:') || 
                link.href.startsWith('tel:') ||
                link.href.includes('#') ||
                link.href.includes('admin:logout') ||
                link.closest('[data-bs-toggle="collapse"]')) {
                return;
            }
            
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const url = this.href;
                const mainContent = document.getElementById('main-content');
                
                // Avoid reloading the same page
                if (window.location.href === url) {
                    return;
                }
                
                // {% trans "Add" %} loading indicator
                this.classList.add('loading');
                mainContent.style.opacity = '0.5';
                
                // {% trans "Add" %} spinner
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'position-absolute top-50 start-50 translate-middle';
                loadingDiv.innerHTML = `
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">{% trans "Loading..." %}</span>
                    </div>
                `;
                mainContent.style.position = 'relative';
                mainContent.appendChild(loadingDiv);
                
                // Send AJAX request
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(html => {
                    // Extract content from loaded page
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newContent = doc.querySelector('.main-content, #main-content');
                    
                    if (newContent) {
                        // Remove loading state
                        this.classList.remove('loading');
                        loadingDiv.remove();
                        
                        // Update content
                        mainContent.innerHTML = newContent.innerHTML;
                        mainContent.style.opacity = '1';
                        
                        // Update URL in address bar
                        history.pushState({url: url}, '', url);
                        
                        // Execute any new scripts in content
                        const scripts = mainContent.querySelectorAll('script');
                        scripts.forEach(script => {
                            if (script.src) {
                                // For external scripts
                                const newScript = document.createElement('script');
                                newScript.src = script.src;
                                document.head.appendChild(newScript);
                            } else {
                                // For inline scripts
                                const newScript = document.createElement('script');
                                newScript.textContent = script.textContent;
                                document.body.appendChild(newScript);
                            }
                        });
                        
                        // Update page title
                        const newTitle = doc.querySelector('title');
                        if (newTitle) {
                            document.title = newTitle.textContent;
                        }
                        
                        // Reinitialize Bootstrap components if needed
                        if (typeof bootstrap !== 'undefined') {
                            // Reinitialize tooltips and popovers
                            const tooltipTriggerList = [].slice.call(mainContent.querySelectorAll('[data-bs-toggle="tooltip"]'));
                            tooltipTriggerList.map(function (tooltipTriggerEl) {
                                return new bootstrap.Tooltip(tooltipTriggerEl);
                            });
                        }
                    } else {
                        throw new Error('Content not found in response');
                    }
                })
                .catch(error => {
                    console.error('Error loading page:', error);
                    // On error, remove loading and navigate normally
                    this.classList.remove('loading');
                    if (loadingDiv.parentNode) {
                        loadingDiv.remove();
                    }
                    mainContent.style.opacity = '1';
                    
                    // Normal redirect as fallback
                    window.location.href = url;
                });
                
                // Update active link using enhanced function
                setActiveSidebarItem();
            });
        });
        
        // Handle browser buttons (Back/Forward)
        window.addEventListener('popstate', function(e) {
            if (e.state && e.state.url) {
                // Load saved page from history
                const url = e.state.url;
                const mainContent = document.getElementById('main-content');
                
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newContent = doc.querySelector('.main-content, #main-content');
                    
                    if (newContent) {
                        mainContent.innerHTML = newContent.innerHTML;
                        
                        // Update title
                        const newTitle = doc.querySelector('title');
                        if (newTitle) {
                            document.title = newTitle.textContent;
                        }
                        
                        // Update active link in sidebar
                        setActiveSidebarItem();
                    }
                })
                .catch(() => {
                    window.location.reload();
                });
            } else {
                // If no saved state exists, reload page
                window.location.reload();
            }
        });
        
        // Handle dropdown menu open/close (close others when opening new one)
        const collapseToggleLinks = document.querySelectorAll('.sidebar a[data-bs-toggle="collapse"]');
        collapseToggleLinks.forEach(link => {
            link.addEventListener('click', function() {
                const targetCollapse = document.querySelector(this.getAttribute('href'));
                const isCurrentlyCollapsed = !targetCollapse.classList.contains('show');
                
                if (isCurrentlyCollapsed) {
                    // If current menu is closed and will be opened, close all other menus
                    const allCollapses = document.querySelectorAll('.sidebar .collapse.show');
                    allCollapses.forEach(collapse => {
                        if (collapse !== targetCollapse) {
                            const bsCollapse = bootstrap.Collapse.getInstance(collapse);
                            if (bsCollapse) {
                                bsCollapse.hide();
                            } else {
                                const newBsCollapse = new bootstrap.Collapse(collapse, {show: false});
                                newBsCollapse.hide();
                            }
                        }
                    });
                }
            });
        });
        
        // Save dropdown menu states
        const collapseElements = document.querySelectorAll('.sidebar .collapse');
        collapseElements.forEach(collapse => {
            collapse.addEventListener('shown.bs.collapse', function() {
                localStorage.setItem('sidebar_' + this.id, 'open');
            });
            
            collapse.addEventListener('hidden.bs.collapse', function() {
                localStorage.setItem('sidebar_' + this.id, 'closed');
            });
            
            // Restore menu states on page load
            const savedState = localStorage.getItem('sidebar_' + collapse.id);
            if (savedState === 'open') {
                const bsCollapse = new bootstrap.Collapse(collapse, {show: true});
            }
        });
    });
    
    // Enhanced print function
    function printPage() {
        // Add print header
        addPrintHeader();
        
        // Optimize tables for printing
        optimizeTablesForPrint();
        
        // Print
        window.print();
        
        // Remove print header after printing
        setTimeout(() => {
            removePrintHeader();
            restoreTablesAfterPrint();
        }, 1000);
    }
    
    function addPrintHeader() {
        // Check for existing print header
        const existingHeader = document.querySelector('.print-header-added');
        if (existingHeader) {
            existingHeader.remove();
        }
        
        // Create print header
        const printHeader = document.createElement('div');
        printHeader.className = 'print-header-added';
        printHeader.style.display = 'none';
        
        const currentDate = new Date();
        const dateStr = currentDate.toLocaleDateString('ar-SA', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        const pageTitle = document.querySelector('h1, h2, h3, h4, .card-title, .page-title')?.textContent?.trim() || 'Report';
        
        printHeader.innerHTML = `
            <div class="print-company-info">
                Finspilot - Integrated Accounting System
            </div>
            <div class="print-header">
                ${pageTitle}
            </div>
            <div class="print-date">
                Print Date: ${dateStr}
            </div>
            <style>
                @media print {
                    .print-header-added {
                        display: block !important;
                    }
                }
            </style>
        `;
        
        // Insert header at beginning of main content
        const mainContent = document.querySelector('.main-content, #main-content, .card-body, .container-fluid');
        if (mainContent) {
            mainContent.insertBefore(printHeader, mainContent.firstChild);
        }
    }
    
    function removePrintHeader() {
        const printHeader = document.querySelector('.print-header-added');
        if (printHeader) {
            printHeader.remove();
        }
    }
    
    function optimizeTablesForPrint() {
        const tables = document.querySelectorAll('.table');
        tables.forEach(table => {
            // Save original view
            table.setAttribute('data-original-width', table.style.width);
            
            // Add CSS classes for printing
            table.classList.add('print-optimized');
            
            // Optimize column display
            const headers = table.querySelectorAll('thead th');
            const rows = table.querySelectorAll('tbody tr');
            
            // Hide action columns
            headers.forEach((header, index) => {
                const headerText = header.textContent.toLowerCase();
                if (headerText.includes('actions') || headerText.includes('operations') || 
                    headerText.includes('control') || headerText.includes('procedures') ||
                    header.querySelector('.btn, button, a[href]')) {
                    header.style.display = 'none';
                    
                    // {% trans "Hide" %} الخ{% trans "No" %}يا المقابلة في كل صف
                    rows.forEach(row => {
                        const cell = row.children[index];
                        if (cell) {
                            cell.style.display = 'none';
                        }
                    });
                }
            });
            
            // {% trans "Add" %} فئات CSS للبيانات {% trans "Number" %}ية
            rows.forEach(row => {
                Array.from(row.children).forEach(cell => {
                    const text = cell.textContent.trim();
                    
                    // التحقق من البيانات {% trans "Number" %}ية
                    if (/^\d+([.,]\d+)*\s*(ريال|ر\.س|SAR|$)?$/.test(text)) {
                        cell.classList.add('numeric-data');
                    }
                    
                    // التحقق من التواريخ
                    if (/\d{4}-\d{2}-\d{2}|\d{2}\/\d{2}\/\d{4}/.test(text)) {
                        cell.classList.add('date-column');
                    }
                    
                    // التحقق من الأرقام المرجعية
                    if (/^[A-Z]{2,}-\d+$/.test(text)) {
                        cell.classList.add('id-column');
                    }
                });
            });
        });
    }
    
    function restoreTablesAfterPrint() {
        const tables = document.querySelectorAll('.table.print-optimized');
        tables.forEach(table => {
            table.classList.remove('print-optimized');
            
            // استعادة ال{% trans "View" %} الأصلي
            const originalWidth = table.getAttribute('data-original-width');
            if (originalWidth) {
                table.style.width = originalWidth;
                table.removeAttribute('data-original-width');
            }
            
            // إظهار الأعمدة ال{% trans "Hidden" %}ة
            const hiddenElements = table.querySelectorAll('[style*="display: none"]');
            hiddenElements.forEach(element => {
                element.style.display = '';
            });
        });
    }
    
    // {% trans "Add" %} معالج لل{% trans "Print" %} بالكيبورد (Ctrl+P)
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'p') {
            e.preventDefault();
            printPage();
        }
    });
    </script>
    
    <!-- Session Management JavaScript -->
    {% if user.is_authenticated %}
    {% load static %}
    <script src="{% static 'core/js/session-manager.js' %}"></script>
    {% endif %}
    
    <!-- Auto Translation JavaScript -->
    <script>
    {% if LANGUAGE_CODE == 'en' %}
    // Auto Translation for English - Extended Dictionary
    const TRANSLATIONS = {
        // Main Navigation
        'لوحة التحكم': 'Dashboard',
        //'Dashboard': 'Dashboard',
        '{% trans "Dashboard" %}': 'Home',
        
        // Statistics
        'إحصائيات المبيعات': 'Sales Statistics',
        'إحصائيات المشتريات': 'Purchase Statistics',
        'إحصائيات المخزون': 'Inventory Statistics',
        'إحصائيات عامة': 'General Statistics',
        
        // Time periods
        'اليوم': 'Today',
        'هذا الشهر': 'This Month',
        'الشهر الماضي': 'Last Month',
        'هذا الربع': 'This Quarter',
        'نصف السنة': 'Half Year',
        'السنة': 'Year',
        'هذه السنة': 'This Year',
        'السنة الماضية': 'Last Year',
        'الأسبوع': 'Week',
        'هذا الأسبوع': 'This Week',
        'الأسبوع الماضي': 'Last Week',
        
        // Documents
        'فاتورة': 'Invoice',
        'فواتير': 'Invoices',
        'كشف مشتريات': 'Purchase Statement',
        'كشف مردودات المشتريات': 'Purchase Returns Statement',
        'كشف مبيعات': 'Sales Statement',
        'كشف مردودات مبيعات': 'Sales Returns Statement',
        'سند': 'Voucher',
        'سندات': 'Vouchers',
        'إيصال': 'Receipt',
        'إيصالات': 'Receipts',
        'مستند': 'Document',
        'مستندات': 'Documents',
        
        // Actions - Extended
        'إضافة': 'Add',
        'إنشاء': 'Create',
        'جديد': 'New',
        'تحرير': 'Edit',
        'تحرير': 'Edit',
        'حذف': 'Delete',
        'إزالة': 'Remove',
        'مسح': 'Delete',
        'عرض': 'View',
        'عرض التفاصيل': 'View Details',
        'التفاصيل': 'Details',
        'حفظ': 'Save',
        'حفظ التغييرات': 'Save Changes',
        'إلغاء': 'Cancel',
        'إلغاء الأمر': 'Cancel',
        'بحث': 'Search',
        'بحث': 'Search',
        'بحث متقدم': 'Advanced Search',
        'تصفية': 'Filter',
        'التصفية': 'Filter',
        'تصدير': 'Export',
        'التصدير': 'Export',
        'طباعة': 'Print',
        'الطباعة': 'Print',
        'تحديث': 'Update',
        'التحديث': 'Update',
        'تأكيد': 'Confirm',
        'التأكيد': 'Confirm',
        'رجوع': 'Back',
        'العودة': 'Back',
        'التالي': 'Next',
        'السابق': 'Previous',
        'إرسال': 'Submit',
        'تطبيق': 'Apply',
        'إعادة تعيين': 'Reset',
        'مسح الحقول': 'Clear Fields',
        'تحميل': 'Download',
        'رفع': 'Upload',
        'استيراد': 'Import',
        
        // Status
        'Status': 'Status',
        'الحالات': 'Statuses',
        'نشط': 'Active',
        'غير نشط': 'Inactive',
        'مؤكد': 'Confirmed',
        'غير مؤكد': 'Unconfirmed',
        'معلق': 'Pending',
        'ملغى': 'Cancelled',
        'مكتمل': 'Completed',
        'غير مكتمل': 'Incomplete',
        'جاري المعالجة': 'Processing',
        'مدفوع': 'Paid',
        'غير مدفوع': 'Unpaid',
        'جزئياً': 'Partial',
        'مرفوض': 'Rejected',
        'موافق عليه': 'Approved',
        'قيد المراجعة': 'Under Review',
        
        // Common Fields
        'اسم': 'Name',
        'الأسماء': 'Names',
        'اسم كامل': 'Full Name',
        'وصف': 'Description',
        'التفاصيل': 'Details',
        'Notes': 'Notes',
        'التعليقات': 'Comments',
        'عنوان': 'Address',
        'العناوين': 'Addresses',
        'هاتف': 'Phone',
        'الجوال': 'Mobile',
        'البريد الإلكتروني': 'Email',
        'موقع إلكتروني': 'Website',
        'رقم': 'Number',
        'الأرقام': 'Numbers',
        'كود': 'Code',
        'الأكواد': 'Codes',
        'رقم مرجعي': 'Reference Number',
        'رقم المرجع': 'Reference No',
        'تاريخ': 'Date',
        'التواريخ': 'Dates',
        'Creation Date': 'Creation Date',
        'تاريخ التحديث': 'Update Date',
        'وقت': 'Time',
        'الأوقات': 'Times',
        'المدة': 'Duration',
        
        // Financial Terms
        'مبلغ': 'Amount',
        'المبالغ': 'Amounts',
        'المجموع': 'Total',
        'مجموع': 'Sum',
        'الإجمالي الفرعي': 'Subtotal',
        'كمية': 'Quantity',
        'الكميات': 'Quantities',
        'سعر': 'Price',
        'الأسعار': 'Prices',
        'سعر الوحدة': 'Unit Price',
        'سعر إجمالي': 'Total Price',
        'الخصم': 'Discount',
        'الخصومات': 'Discounts',
        'نسبة الخصم': 'Discount Rate',
        'الضريبة': 'Tax',
        'الضرائب': 'Taxes',
        'نسبة الضريبة': 'Tax Rate',
        'القيمة المضافة': 'VAT',
        'المدين': 'Debit',
        'الدائن': 'Credit',
        'الرصيد': 'Balance',
        'الأرصدة': 'Balances',
        'المدفوع': 'Paid',
        'المتبقي': 'Remaining',
        'المستحق': 'Due',
        'Currency': 'Currency',
        'Currencies': 'Currencies',
        
        // Data Table Terms
        'النتائج': 'Results',
        'البيانات': 'Data',
        'القائمة': 'List',
        'القوائم': 'Lists',
        'ال{% trans "Table" %}': 'Table',
        'الجداول': 'Tables',
        'الصفحة': 'Page',
        'الصفحات': 'Pages',
        'عنصر': 'Item',
        'عناصر': 'Items',
        'سجل': 'Record',
        'سجلات': 'Records',
        'الصف': 'Row',
        'الصفوف': 'Rows',
        'العمود': 'Column',
        'الأعمدة': 'Columns',
        'العمليات': 'Actions',
        'الخيارات': 'Options',
        'Settings': 'Settings',
        'التكوين': 'Configuration',
        
        // Messages
        'تم الحفظ بنجاح': 'Saved Successfully',
        'تم التحديث بنجاح': 'Updated Successfully',
        'تم الحذف بنجاح': 'Deleted Successfully',
        'تم الإنشاء بنجاح': 'Created Successfully',
        'تمت العملية بنجاح': 'Operation Completed Successfully',
        'حدث خطأ': 'An Error Occurred',
        'خطأ في البيانات': 'Data Error',
        'خطأ في النظام': 'System Error',
        'لا توجد نتائج': 'No Results Found',
        'لا توجد بيانات': 'No Data Available',
        'البيانات فارغة': 'No Data',
        'تأكيد الحذف': 'Confirm Delete',
        'هل أنت متأكد من الحذف؟': 'Are you sure you want to delete?',
        'لا يمكن التراجع عن هذا الإجراء': 'This action cannot be undone',
        'تحذير': 'Warning',
        'تنبيه': 'Alert',
        'معلومات': 'Information',
        'نجح': 'Success',
        'فشل': 'Failed',
        'مطلوب': 'Required',
        'إجباري': 'Required',
        'اختياري': 'Optional',
        'يجب ملء هذا الحقل': 'This field is required',
        'صيغة غير صحيحة': 'Invalid format',
        
        // Business Terms
        'شركة': 'Company',
        'الشركة': 'Company',
        'الشركات': 'Companies',
        'عميل': 'Customer',
        'العميل': 'Customer',
        'عملاء': 'Customers',
        'العملاء': 'Customers',
        'مورد': 'Supplier',
        'المورد': 'Supplier',
        'موردون': 'Suppliers',
        'الموردون': 'Suppliers',
        'منتج': 'Product',
        'المنتج': 'Product',
        'منتجات': 'Products',
        'المنتجات': 'Products',
        'خدمة': 'Service',
        'الخدمة': 'Service',
        'خدمات': 'Services',
        'الخدمات': 'Services',
        'مشروع': 'Project',
        'المشروع': 'Project',
        'مشاريع': 'Projects',
        'المشاريع': 'Projects',
        
        // User Interface
        'تسجيل الدخول': 'Login',
        'Logout': 'Logout',
        '{% trans "Exit" %}': 'Logout',
        'تسجيل': 'Register',
        'User': 'User',
        'المستخدمون': 'Users',
        'Password': 'Password',
        'كلمة السر': 'Password',
        'Username': 'Username',
        'البروفايل': 'Profile',
        '{% trans "Profile" %}': 'Profile',
        'الصلاحيات': 'Permissions',
        'الأدوار': 'Roles',
        'مجموعة': 'Group',
        'مجموعات': 'Groups',
        
        // Common Words
        'من': 'From',
        'إلى': 'To',
        'في': 'In',
        'على': 'On',
        'عند': 'At',
        'مع': 'With',
        'بدون': 'Without',
        'كل': 'All',
        'جميع': 'All',
        'بعض': 'Some',
        'أخرى': 'Other',
        'آخر': 'Last',
        'أول': 'First',
        'ثاني': 'Second',
        'ثالث': 'Third',
        'نعم': 'Yes',
        'لا': 'No',
        'موافق': 'OK',
        'تم': 'Done',
        'انتهى': 'Finished',
        'جاهز': 'Ready',
        'متاح': 'Available',
        'غير متاح': 'Unavailable',
        'مفتوح': 'Open',
        'مغلق': 'Closed',
        'عام': 'General',
        'خاص': 'Private',
        'عمومي': 'Public',
        'داخلي': 'Internal',
        'خارجي': 'External',
        
        // Additional Business Terms
        'فرع': 'Branch',
        'الفرع': 'Branch',
        'فروع': 'Branches',
        'الفروع': 'Branches',
        'قسم': 'Department',
        'القسم': 'Department',
        'أقسام': 'Departments',
        'الأقسام': 'Departments',
        'وحدة': 'Unit',
        'الوحدة': 'Unit',
        'وحدات': 'Units',
        'الوحدات': 'Units',
        'مخزن': 'Warehouse',
        'المخزن': 'Warehouse',
        'مخازن': 'Warehouses',
        'المخازن': 'Warehouses',
        'مستودع': 'Warehouse',
        'المستودع': 'Warehouse',
        'مستودعات': 'Warehouses',
        'المستودعات': 'Warehouses',
        
        // Form Elements
        'اختر': 'Choose',
        'اختيار': 'Select',
        'اختر من القائمة': 'Select from List',
        'حدد': 'Select',
        'اختيار': 'Select',
        'اختر تاريخ': 'Choose Date',
        'أدخل': 'Enter',
        'إدخال': 'Enter',
        'اكتب': 'Type',
        'كتابة': 'Type',
        'ارفع ملف': 'Upload File',
        'رفع الملفات': 'Upload Files',
        'تحميل': 'Download',
        'تنزيل': 'Download',
        'استعراض': 'Browse',
        'تصفح': 'Browse',
        
        // Reports and Analytics
        'تقرير': 'Report',
        'التقرير': 'Report',
        'تقارير': 'Reports',
        'Reports': 'Reports',
        'إحصائية': 'Statistic',
        'الإحصائية': 'Statistic',
        'إحصائيات': 'Statistics',
        'الإحصائيات': 'Statistics',
        'تحليل': 'Analysis',
        'التحليل': 'Analysis',
        'تحليلات': 'Analytics',
        'التحليلات': 'Analytics',
        'مخطط': 'Chart',
        'الرسم البياني': 'Chart',
        'رسوم بيانية': 'Charts',
        'الرسوم البيانية': 'Charts',
        'جدول': 'Table',
        'الجدول': 'Table',
        'جداول': 'Tables',
        'الجداول': 'Tables',
        
        // Time-related Terms
        'صباحاً': 'AM',
        'مساءً': 'PM',
        'يومياً': 'Daily',
        'أسبوعياً': 'Weekly',
        'شهرياً': 'Monthly',
        'سنوياً': 'Annually',
        'فوراً': 'Immediately',
        'لاحقاً': 'Later',
        'قريباً': 'Soon',
        'بعد قليل': 'Shortly',
        'الآن': 'Now',
        'حالياً': 'Currently',
        'مؤقتاً': 'Temporarily',
        'دائماً': 'Always',
        'أبداً': 'Never',
        'أحياناً': 'Sometimes',
        
        // Additional Interface Terms
        'قائمة': 'Menu',
        'القائمة': 'Menu',
        'قوائم': 'Menus',
        'القوائم': 'Menus',
        'شريط': 'Bar',
        'الشريط': 'Bar',
        'أشرطة': 'Bars',
        'الأشرطة': 'Bars',
        'زر': 'Button',
        'الزر': 'Button',
        'أزرار': 'Buttons',
        'الأزرار': 'Buttons',
        'رابط': 'Link',
        'الرابط': 'Link',
        'روابط': 'Links',
        'الروابط': 'Links',
        'صورة': 'Image',
        'الصورة': 'Image',
        'صور': 'Images',
        'الصور': 'Images',
        'ملف': 'File',
        'الملف': 'File',
        'ملفات': 'Files',
        'الملفات': 'Files',
        'مجلد': 'Folder',
        'المجلد': 'Folder',
        'مجلدات': 'Folders',
        'المجلدات': 'Folders',
        
        // Additional Status Terms
        'جديد': 'New',
        'الجديد': 'New',
        'قديم': 'Old',
        'القديم': 'Old',
        'محدث': 'Updated',
        'المحدث': 'Updated',
        'محذوف': 'Deleted',
        'المحذوف': 'Deleted',
        'مضاف': 'Added',
        'المضاف': 'Added',
        'معدل': 'Modified',
        'المعدل': 'Modified',
        'مكرر': 'Duplicate',
        'المكرر': 'Duplicate',
        'فريد': 'Unique',
        'الفريد': 'Unique',
        'صحيح': 'Valid',
        'الصحيح': 'Valid',
        'خاطئ': 'Invalid',
        'الخاطئ': 'Invalid',
        
        // Accounting Specific Terms
        'حساب': 'Account',
        'الحساب': 'Account',
        'حسابات': 'Accounts',
        'الحسابات': 'Accounts',
        'قيد': 'Entry',
        'القيد': 'Entry',
        'قيود': 'Entries',
        'القيود': 'Entries',
        'يومية': 'Journal',
        'يومية': 'Journal',
        'دفتر': 'Book',
        'الدفتر': 'Book',
        'دفاتر': 'Books',
        'الدفاتر': 'Books',
        'سجل': 'Record',
        'السجل': 'Record',
        'سج{% trans "No" %}ت': 'Records',
        'السجلات': 'Records',
        'ميزانية': 'Budget',
        'الميزانية': 'Budget',
        'ميزانيات': 'Budgets',
        'الميزانيات': 'Budgets',
        'كشف': 'Statement',
        'الكشف': 'Statement',
        'كشوف': 'Statements',
        'الكشوف': 'Statements',
        
        // More Common Arabic Words
        'مبيعات': 'Sales',
        'Sales': 'Sales',
        'مشتريات': 'Purchases', 
        'Purchases': 'Purchases',
        'مخزون': 'Inventory',
        'المخزون': 'Inventory',
        'إيرادات': 'Revenues',
        'الإيرادات': 'Revenues',
        'مصروفات': 'Expenses',
        'المصروفات': 'Expenses',
        'أصول': 'Assets',
        'الأصول': 'Assets',
        'خصوم': 'Liabilities',
        'الخصوم': 'Liabilities',
        'Global Search': 'Global Search',
        'Bank Accounts': 'Bank Accounts',
        'الصناديق': 'Cashboxes',
        'Payment Receipts': 'Payment Receipts',
        'سندات الدفع': 'Payment Vouchers',
        'Categories & Products': 'Categories & Products',
        'Customers & Suppliers': 'Customers & Suppliers',
        'القيود المحاسبية': 'Journal Entries',
        'Assets & Liabilities': 'Assets & Liabilities',
        'Revenues & Expenses': 'Revenues & Expenses',
        'إدارة السوبر أدمين': 'Superadmin Management',
        'إدارة النظام': 'System Management',
        'متقدم': 'Advanced',
        'المجموعات والصلاحيات': 'Groups & Permissions',
        'سجل الأنشطة': 'Activity Log',
        'إدارة أرقام المستندات': 'Document Numbers Management',
        'إعدادات النظام': 'System Settings',
        'إعدادات': 'Settings',
        'Settings': 'Settings',
        'Logout': 'Logout',
        '{% trans "Exit" %}': 'Logout',
        'Dashboard': 'Dashboard',
        '{% trans "Dashboard" %}': 'Home',
        'Arabic': 'Arabic',
        'English': 'English',
        'اختر اللغة': 'Choose Language',
        'التنبيهات': 'Notifications',
        'الملف الشخصي': 'Profile',
        'ادارة المستخدمين': 'User Management',
        'المستخدمين': 'Users',
        'اضافة مستخدم': 'Add User',
        'تحرير مستخدم': 'Edit User',
        'حذف مستخدم': 'Delete User',
        '{% trans "List" %} المستخدمين': 'Users List',
        
        // Navigation Terms
        'لوحة القيادة': 'Dashboard',
        'ال{% trans "List" %} {% trans "Dashboard" %}': 'Main Menu',
        'ال{% trans "List" %} الجانبية': 'Sidebar',
        '{% trans "Home" %}': 'Home Page',
        'عودة للرئيسية': 'Back to Home',
        'اتصل بنا': 'Contact Us',
        'عن الشركة': 'About Company',
        'سياسة الخصوصية': 'Privacy Policy',
        'الشروط والأحكام': 'Terms & Conditions',
        
        // Action Buttons
        '{% trans "Add" %} {% trans "New" %}': 'Add New',
        'إنشاء {% trans "New" %}': 'Create New',
        '{% trans "Edit" %} البيانات': 'Edit Data',
        '{% trans "Save" %} البيانات': 'Save Data',
        '{% trans "Delete" %} البيانات': 'Delete Data',
        '{% trans "View" %} البيانات': 'View Data',
        '{% trans "Print" %} ال{% trans "Report" %}': 'Print Report',
        '{% trans "Export" %} البيانات': 'Export Data',
        '{% trans "Import" %} البيانات': 'Import Data',
        'تحديث البيانات': 'Update Data',
        'إعادة تحميل': 'Reload',
        'تراجع': 'Undo',
        'إعادة': 'Redo',
        'نسخ': 'Copy',
        'لصق': 'Paste',
        'قص': 'Cut',
        
        // Form Labels
        'Username': 'Username',
        'Password': 'Password',
        'البريد ا{% trans "No" %}لكتروني': 'Email',
        'رقم {% trans "Phone" %}': 'Phone Number',
        '{% trans "Address" %} الالكامل': 'Full Address',
        'تاريخ المي{% trans "No" %}د': 'Date of Birth',
        'الجنسية': 'Nationality',
        '{% trans "City" %}': 'City',
        'البلد': 'Country',
        'الرمز البريدي': 'Postal Code',
        'نوع الحساب': 'Account Type',
        'Account Number': 'Account Number',
        'Bank Name': 'Bank Name',
        'فرع البنك': 'Bank Branch',
        
        // Status Messages
        'تم الحفظ': 'Saved',
        'تم التعديل': 'Modified',
        'تم الحذف': 'Deleted',
        'تم الإنشاء': 'Created',
        'تم التحديث': 'Updated',
        'تم الإرسال': 'Sent',
        'تم الاستلام': 'Received',
        'تم التأكيد': 'Confirmed',
        'تم الإلغاء': 'Cancelled',
        'في ا{% trans "No" %}نتظار': 'Pending',
        'قيد المراجعة': 'Under Review',
        '{% trans "Rejected" %}': 'Rejected',
        'مقبول': 'Accepted',
        '{% trans "OK" %} عليه': 'Approved',
        
        // Error Messages
        '{% trans "Error" %} في النظام': 'System Error',
        '{% trans "Error" %} في قاعدة البيانات': 'Database Error',
        '{% trans "Error" %} في ا{% trans "No" %}تصال': 'Connection Error',
        'بيانات غير صحيحة': 'Invalid Data',
        'حقل مطلوب': 'Required Field',
        'تم تجاوز الحد المسموح': 'Limit Exceeded',
        'غير مصرح': 'Unauthorized',
        'منتهي الصلاحية': 'Expired',
        'غير موجود': 'Not Found',
        'غير {% trans "Available" %}': 'Not Available',
        
        // Financial Terms
        'ريال سعودي': 'Saudi Riyal',
        'ريال': 'Riyal',
        'ر.س': 'SAR',
        'جنيه مصري': 'Egyptian Pound',
        'دو{% trans "No" %}ر أمريكي': 'US Dollar',
        'يورو': 'Euro',
        'دينار كويتي': 'Kuwaiti Dinar',
        'درهم إماراتي': 'UAE Dirham',
        'قرش': 'Piaster',
        'هللة': 'Halalah',
        
        // Additional Common Words and Phrases
        'صفحة': 'Page',
        'الصفحة': 'Page',
        'صفحات': 'Pages',
        'الصفحات': 'Pages',
        'نافذة': 'Window',
        'النافذة': 'Window',
        'نوافذ': 'Windows',
        'النوافذ': 'Windows',
        'حقل': 'Field',
        'الحقل': 'Field',
        'حقول': 'Fields',
        'الحقول': 'Fields',
        'استمارة': 'Form',
        'الاستمارة': 'Form',
        'استمارات': 'Forms',
        'ا{% trans "No" %}ستمارات': 'Forms',
        'نموذج': 'Form',
        'النموذج': 'Form',
        'نماذج': 'Forms',
        'النماذج': 'Forms',
        
        // Database and System Terms
        'قاعدة البيانات': 'Database',
        'قاعدة بيانات': 'Database',
        'قواعد البيانات': 'Databases',
        'قواعد بيانات': 'Databases',
        'خادم': 'Server',
        'الخادم': 'Server',
        'خوادم': 'Servers',
        'الخوادم': 'Servers',
        'شبكة': 'Network',
        'الشبكة': 'Network',
        'شبكات': 'Networks',
        'الشبكات': 'Networks',
        'اتصال': 'Connection',
        'ا{% trans "No" %}تصال': 'Connection',
        'اتصا{% trans "No" %}ت': 'Connections',
        'ا{% trans "No" %}تصا{% trans "No" %}ت': 'Connections',
        
        // Action Words
        'تشغيل': 'Run',
        'التشغيل': 'Run',
        'إيقاف': 'Stop',
        'الإيقاف': 'Stop',
        'بدء': 'Start',
        'البدء': 'Start',
        'انتهاء': 'End',
        'ا{% trans "No" %}نتهاء': 'End',
        'استكمال': 'Complete',
        'ا{% trans "No" %}ستكمال': 'Complete',
        'متابعة': 'Continue',
        'المتابعة': 'Continue',
        'توقف': 'Pause',
        'التوقف': 'Pause',
        'استئناف': 'Resume',
        'ا{% trans "No" %}ستئناف': 'Resume',
        
        // UI Elements
        'شاشة': 'Screen',
        'الشاشة': 'Screen',
        'شاشات': 'Screens',
        'الشاشات': 'Screens',
        'رمز': 'Icon',
        'الرمز': 'Icon',
        'رموز': 'Icons',
        'الرموز': 'Icons',
        'ع{% trans "No" %}مة': 'Mark',
        'الع{% trans "No" %}مة': 'Mark',
        'ع{% trans "No" %}مات': 'Marks',
        'الع{% trans "No" %}مات': 'Marks',
        'إشارة': 'Sign',
        'الإشارة': 'Sign',
        'إشارات': 'Signs',
        'الإشارات': 'Signs',
        
        // Content Management
        'محتوى': 'Content',
        'المحتوى': 'Content',
        'محتويات': 'Contents',
        'المحتويات': 'Contents',
        'نص': 'Text',
        'النص': 'Text',
        'نصوص': 'Texts',
        'النصوص': 'Texts',
        'كلمة': 'Word',
        '{% trans "All" %}مة': 'Word',
        'كلمات': 'Words',
        '{% trans "All" %}مات': 'Words',
        'جملة': 'Sentence',
        'الجملة': 'Sentence',
        'جمل': 'Sentences',
        'الجمل': 'Sentences',
        'فقرة': 'Paragraph',
        'الفقرة': 'Paragraph',
        'فقرات': 'Paragraphs',
        'الفقرات': 'Paragraphs',
        
        // More Business Terms
        'إدارة': 'Management',
        'الإدارة': 'Management',
        'مدير': 'Manager',
        'المدير': 'Manager',
        'مديرون': 'Managers',
        'المديرون': 'Managers',
        'موظف': 'Employee',
        'الموظف': 'Employee',
        'موظفون': 'Employees',
        'الموظفون': 'Employees',
        'عامل': 'Worker',
        'العامل': 'Worker',
        'عمال': 'Workers',
        'العمال': 'Workers',
        'فريق': 'Team',
        'الفريق': 'Team',
        'فرق': 'Teams',
        'الفرق': 'Teams',
        
        // More Financial Terms
        '{% trans "Payment" %}ة': 'Payment',
        'ال{% trans "Payment" %}ة': 'Payment',
        '{% trans "Payment" %}ات': 'Payments',
        'ال{% trans "Payment" %}ات': 'Payments',
        'قسط': 'Installment',
        'القسط': 'Installment',
        'أقساط': 'Installments',
        'الأقساط': 'Installments',
        'فائدة': 'Interest',
        'الفائدة': 'Interest',
        'فوائد': 'Interests',
        'الفوائد': 'Interests',
        'عمولة': 'Commission',
        'العمولة': 'Commission',
        'عمو{% trans "No" %}ت': 'Commissions',
        'العمو{% trans "No" %}ت': 'Commissions',
        'رسوم': 'Fees',
        'الرسوم': 'Fees',
        'رسم': 'Fee',
        'الرسم': 'Fee',
        
        // Transaction Terms
        'معاملة': 'Transaction',
        'المعاملة': 'Transaction',
        'معام{% trans "No" %}ت': 'Transactions',
        'المعام{% trans "No" %}ت': 'Transactions',
        'عملية': 'Operation',
        'العملية': 'Operation',
        'عمليات': 'Operations',
        'العمليات': 'Operations',
        'إجراء': 'Procedure',
        'الإجراء': 'Procedure',
        'إجراءات': 'Procedures',
        'الإجراءات': 'Procedures',
        'خطوة': 'Step',
        'الخطوة': 'Step',
        'خطوات': 'Steps',
        'الخطوات': 'Steps',
        
        // Time and Date Terms
        'يوم': 'Day',
        '{% trans "Today" %}': 'Day',
        'أيام': 'Days',
        'الأيام': 'Days',
        'شهر': 'Month',
        'الشهر': 'Month',
        'أشهر': 'Months',
        'الأشهر': 'Months',
        'سنة': 'Year',
        'السنة': 'Year',
        'سنوات': 'Years',
        'السنوات': 'Years',
        'ساعة': 'Hour',
        'الساعة': 'Hour',
        'ساعات': 'Hours',
        'الساعات': 'Hours',
        'دقيقة': 'Minute',
        'الدقيقة': 'Minute',
        'دقائق': 'Minutes',
        'الدقائق': 'Minutes',
        'ثانية': 'Second',
        '{% trans "Second" %}ة': 'Second',
        'ثوان': 'Seconds',
        'الثوان': 'Seconds',
        
        // Colors
        'أحمر': 'Red',
        'أخضر': 'Green',
        'أزرق': 'Blue',
        'أصفر': 'Yellow',
        'أسود': 'Black',
        'أبيض': 'White',
        'رمادي': 'Gray',
        'بني': 'Brown',
        'برتقالي': 'Orange',
        'بنفسجي': 'Purple',
        'وردي': 'Pink',
        
        // Directions
        'يمين': 'Right',
        'يسار': 'Left',
        'أعلى': 'Top',
        'أسفل': 'Bottom',
        'وسط': 'Center',
        'شمال': 'North',
        'جنوب': 'South',
        'شرق': 'East',
        'غرب': 'West',
        
        // More Common Verbs
        'ي{% trans "Open" %}': 'Opens',
        'يغلق': 'Closes',
        'يظهر': 'Shows',
        'يخفي': 'Hides',
        'يرسل': 'Sends',
        'يستقبل': 'Receives',
        'يقرأ': 'Reads',
        'يكتب': 'Writes',
        'يطبع': 'Prints',
        'يحمل': 'Loads',
        'ي{% trans "Save" %}': 'Saves',
        'ي{% trans "Delete" %}': 'Deletes',
        'يعدل': 'Edits',
        'ينشئ': 'Creates',
        'يضيف': 'Adds',
        'يزيل': 'Removes',
        'يبحث': 'Searches',
        'يجد': 'Finds',
        'يختار': 'Selects',
        'يحدد': 'Specifies',
        
        // Technical Terms
        'تطبيق': 'Application',
        'التطبيق': 'Application',
        'تطبيقات': 'Applications',
        'التطبيقات': 'Applications',
        'برنامج': 'Program',
        'البرنامج': 'Program',
        'برامج': 'Programs',
        'البرامج': 'Programs',
        'نظام': 'System',
        'النظام': 'System',
        'أنظمة': 'Systems',
        'الأنظمة': 'Systems',
        'تقنية': 'Technology',
        'التقنية': 'Technology',
        'تقنيات': 'Technologies',
        'التقنيات': 'Technologies'
    };
    
    // Enhanced Ultra-Comprehensive Translation System
    function translateText(text) {
        if (!text || typeof text !== 'string') return text;
        
        let translatedText = text.trim();
        
        // Direct translation first
        if (TRANSLATIONS[translatedText]) {
            return TRANSLATIONS[translatedText];
        }
        
        // Enhanced word-by-word translation for mixed content
        const words = translatedText.split(/\s+/);
        let hasTranslation = false;
        
        const translatedWords = words.map(word => {
            // Clean the word from punctuation for translation
            const cleanWord = word.replace(/[،؛:.!?()[\]{}"""''`~@#$%^&*+=<>]/g, '');
            
            // Check if cleaned word exists in translations
            if (TRANSLATIONS[cleanWord]) {
                hasTranslation = true;
                return word.replace(cleanWord, TRANSLATIONS[cleanWord]);
            }
            
            // Check for variations with "ال" prefix
            if (cleanWord.startsWith('ال') && cleanWord.length > 2) {
                const withoutAl = cleanWord.substring(2);
                if (TRANSLATIONS[withoutAl]) {
                    hasTranslation = true;
                    return word.replace(cleanWord, 'The ' + TRANSLATIONS[withoutAl]);
                }
                if (TRANSLATIONS['ال' + withoutAl]) {
                    hasTranslation = true;
                    return word.replace(cleanWord, TRANSLATIONS['ال' + withoutAl]);
                }
            }
            
            // Check for plurals ending with "ات", "ون", "ين"
            if (cleanWord.endsWith('ات') && cleanWord.length > 3) {
                const singular = cleanWord.substring(0, cleanWord.length - 2);
                if (TRANSLATIONS[singular]) {
                    hasTranslation = true;
                    return word.replace(cleanWord, TRANSLATIONS[singular] + 's');
                }
            }
            
            if (cleanWord.endsWith('ون') && cleanWord.length > 3) {
                const singular = cleanWord.substring(0, cleanWord.length - 2);
                if (TRANSLATIONS[singular]) {
                    hasTranslation = true;
                    return word.replace(cleanWord, TRANSLATIONS[singular] + 's');
                }
            }
            
            if (cleanWord.endsWith('ين') && cleanWord.length > 3) {
                const singular = cleanWord.substring(0, cleanWord.length - 2);
                if (TRANSLATIONS[singular]) {
                    hasTranslation = true;
                    return word.replace(cleanWord, TRANSLATIONS[singular] + 's');
                }
            }
            
            return word;
        });
        
        if (hasTranslation) {
            translatedText = translatedWords.join(' ');
        }
        
        // Enhanced partial translations - check all possible substrings
        const sortedKeys = Object.keys(TRANSLATIONS).sort((a, b) => b.length - a.length);
        sortedKeys.forEach(arabicText => {
            if (translatedText.includes(arabicText)) {
                const regex = new RegExp(arabicText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                translatedText = translatedText.replace(regex, TRANSLATIONS[arabicText]);
            }
        });
        
        return translatedText;
    }
    
    function translatePage() {
        try {
            // Ultra-comprehensive translation approach
            
            // Phase 1: TreeWalker for all text nodes
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        // Skip script, style, and other non-visible elements
                        const parent = node.parentElement;
                        if (!parent || ['SCRIPT', 'STYLE', 'NOSCRIPT', 'META', 'LINK'].includes(parent.tagName)) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        
                        const text = node.textContent.trim();
                        if (text && /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(text)) {
                            return NodeFilter.FILTER_ACCEPT;
                        }
                        return NodeFilter.FILTER_REJECT;
                    }
                }
            );
            
            let textNode;
            const textNodes = [];
            while (textNode = walker.nextNode()) {
                textNodes.push(textNode);
            }
            
            // Translate all collected text nodes
            textNodes.forEach(node => {
                const originalText = node.textContent.trim();
                if (originalText) {
                    const translatedText = translateText(originalText);
                    if (translatedText !== originalText) {
                        node.textContent = translatedText;
                    }
                }
            });
            
            // Phase 2: Element-based translation for specific selectors
            const selectors = [
                'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                'p', 'span', 'div', 'a', 'button', 'label',
                'th', 'td', 'li', 'option', 'legend',
                '.nav-link', '.btn', '.form-label', '.card-title', '.card-text',
                '.alert', '.badge', '.breadcrumb-item', '.dropdown-item',
                '.nav-item', '.sidebar-nav-item', '.navbar-nav a'
            ];
            
            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(element => {
                    if (element.textContent && /[\u0600-\u06FF]/.test(element.textContent)) {
                        // Only translate if element contains only text (no nested elements with different content)
                        if (element.children.length === 0 || 
                            (element.children.length === 1 && element.children[0].tagName === 'I' && element.children[0].classList.contains('fas'))) {
                            const originalText = element.textContent.trim();
                            const translatedText = translateText(originalText);
                            if (translatedText !== originalText) {
                                if (element.children.length === 1 && element.children[0].tagName === 'I') {
                                    // Preserve icon and translate only text
                                    const icon = element.children[0].outerHTML;
                                    element.innerHTML = icon + ' ' + translatedText.replace(originalText.trim(), '').trim();
                                } else {
                                    element.textContent = translatedText;
                                }
                            }
                        }
                    }
                });
            });
            
            // Phase 3: Attribute translation
            const attributesToTranslate = [
                'placeholder', 'title', 'alt', 'data-original-title', 
                'aria-label', 'data-bs-title', 'data-bs-original-title',
                'value', 'label', 'aria-labelledby'
            ];
            
            attributesToTranslate.forEach(attr => {
                document.querySelectorAll(`[${attr}]`).forEach(element => {
                    const originalValue = element.getAttribute(attr);
                    if (originalValue && originalValue.trim() && /[\u0600-\u06FF]/.test(originalValue)) {
                        const translatedValue = translateText(originalValue.trim());
                        if (translatedValue !== originalValue.trim()) {
                            element.setAttribute(attr, translatedValue);
                        }
                    }
                });
            });
            
            // Phase 4: Input values and option texts
            document.querySelectorAll('input[type="text"], input[type="search"], textarea').forEach(input => {
                if (input.value && /[\u0600-\u06FF]/.test(input.value)) {
                    const translatedValue = translateText(input.value);
                    if (translatedValue !== input.value) {
                        input.value = translatedValue;
                    }
                }
            });
            
            // Phase 5: Special Bootstrap components
            document.querySelectorAll('.dropdown-menu .dropdown-item').forEach(item => {
                if (item.textContent && /[\u0600-\u06FF]/.test(item.textContent)) {
                    const originalText = item.textContent.trim();
                    const translatedText = translateText(originalText);
                    if (translatedText !== originalText) {
                        item.textContent = translatedText;
                    }
                }
            });
            
            // Phase 6: Table content
            document.querySelectorAll('table').forEach(table => {
                table.querySelectorAll('th, td').forEach(cell => {
                    if (cell.textContent && /[\u0600-\u06FF]/.test(cell.textContent) && cell.children.length === 0) {
                        const originalText = cell.textContent.trim();
                        const translatedText = translateText(originalText);
                        if (translatedText !== originalText) {
                            cell.textContent = translatedText;
                        }
                    }
                });
            });
            
            // Phase 7: Form elements
            document.querySelectorAll('form').forEach(form => {
                form.querySelectorAll('label, legend, .form-text, .help-text').forEach(element => {
                    if (element.textContent && /[\u0600-\u06FF]/.test(element.textContent)) {
                        const originalText = element.textContent.trim();
                        const translatedText = translateText(originalText);
                        if (translatedText !== originalText) {
                            element.textContent = translatedText;
                        }
                    }
                });
            });
            
        } catch (error) {
            console.log('Translation error:', error);
        }
    }
    
    // Ultra-Advanced Translation Execution System
    document.addEventListener('DOMContentLoaded', function() {
        // Initial translations with increasing delays
        setTimeout(translatePage, 100);   // Very early
        setTimeout(translatePage, 300);   // Early
        setTimeout(translatePage, 600);   // Medium
        setTimeout(translatePage, 1000);  // Late
        setTimeout(translatePage, 2000);  // Very late
        
        // Force translation of special forms and tables
        setTimeout(translateFormsAndTables, 500);
        setTimeout(translateFormsAndTables, 1200);
        setTimeout(translateFormsAndTables, 2500);
        
        // Ultimate force translation
        setTimeout(forceTranslateAll, 3000);
        setTimeout(forceTranslateAll, 5000);
        
        // Continuous translation every 3 seconds
        setInterval(function() {
            if (document.documentElement.lang === 'en') {
                translatePage();
            }
        }, 3000);
        
        // Also run translation when page becomes visible (tab focus)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && document.documentElement.lang === 'en') {
                setTimeout(translatePage, 100);
                setTimeout(translateFormsAndTables, 200);
            }
        });
        
        // Translation on scroll (for lazy-loaded content)
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            if (document.documentElement.lang === 'en') {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(translatePage, 500);
            }
        });
        
        // Translation on resize (for responsive content)
        let resizeTimeout;
        window.addEventListener('resize', function() {
            if (document.documentElement.lang === 'en') {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(translatePage, 300);
            }
        });
    });
    
    // Advanced Dynamic Content Observer
    const observer = new MutationObserver(function(mutations) {
        let needsTranslation = false;
        
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
                // Check added nodes
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === Node.ELEMENT_NODE) {
                        // Check if the added element contains Arabic text
                        if (node.textContent && /[\u0600-\u06FF]/.test(node.textContent)) {
                            needsTranslation = true;
                        }
                    } else if (node.nodeType === Node.TEXT_NODE) {
                        // Check if the added text node is Arabic
                        if (node.textContent && /[\u0600-\u06FF]/.test(node.textContent)) {
                            needsTranslation = true;
                        }
                    }
                });
            } else if (mutation.type === 'characterData') {
                // Check modified text content
                if (mutation.target.textContent && /[\u0600-\u06FF]/.test(mutation.target.textContent)) {
                    needsTranslation = true;
                }
            } else if (mutation.type === 'attributes') {
                // Check modified attributes
                const element = mutation.target;
                const attributeName = mutation.attributeName;
                if (['placeholder', 'title', 'alt', 'aria-label', 'data-bs-title'].includes(attributeName)) {
                    const attributeValue = element.getAttribute(attributeName);
                    if (attributeValue && /[\u0600-\u06FF]/.test(attributeValue)) {
                        needsTranslation = true;
                    }
                }
            }
        });
        
        if (needsTranslation && document.documentElement.lang === 'en') {
            // Immediate translation for critical content
            setTimeout(translatePage, 50);
            // Follow-up translation to catch any missed content
            setTimeout(translatePage, 300);
            setTimeout(translateFormsAndTables, 400);
        }
    });
    
    // Start observing the document with comprehensive options
    observer.observe(document.body, {
        childList: true,
        subtree: true,
        characterData: true,
        attributes: true,
        attributeFilter: ['placeholder', 'title', 'alt', 'aria-label', 'data-bs-title', 'value', 'textContent']
    });
    
    // Comprehensive Event-Based Translation System
    
    // Translation on various user interactions
    ['click', 'focus', 'blur', 'change', 'input', 'keyup', 'mouseenter', 'mouseleave'].forEach(eventType => {
        document.addEventListener(eventType, function(e) {
            if (document.documentElement.lang === 'en') {
                // Delayed translation to allow for content updates
                setTimeout(translatePage, 100);
            }
        });
    });
    
    // Special handling for form submissions and AJAX calls
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        return originalFetch.apply(this, args).then(response => {
            if (document.documentElement.lang === 'en') {
                // Translate after AJAX content is loaded
                setTimeout(translatePage, 200);
                setTimeout(translateFormsAndTables, 400);
            }
            return response;
        });
    };
    
    // Override XMLHttpRequest for older AJAX calls
    const originalXHROpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function() {
        this.addEventListener('load', function() {
            if (document.documentElement.lang === 'en') {
                setTimeout(translatePage, 150);
                setTimeout(translateFormsAndTables, 300);
            }
        });
        return originalXHROpen.apply(this, arguments);
    };
    
    // Translation on hash change and popstate
    window.addEventListener('hashchange', function() {
        if (document.documentElement.lang === 'en') {
            setTimeout(translatePage, 200);
        }
    });
    
    window.addEventListener('popstate', function() {
        if (document.documentElement.lang === 'en') {
            setTimeout(translatePage, 300);
        }
    });
    
    // Translation when Bootstrap components are shown
    document.addEventListener('shown.bs.modal', function() {
        if (document.documentElement.lang === 'en') {
            setTimeout(translatePage, 100);
        }
    });
    
    document.addEventListener('shown.bs.collapse', function() {
        if (document.documentElement.lang === 'en') {
            setTimeout(translatePage, 100);
        }
    });
    
    document.addEventListener('shown.bs.dropdown', function() {
        if (document.documentElement.lang === 'en') {
            setTimeout(translatePage, 50);
        }
    });
    
    document.addEventListener('shown.bs.tab', function() {
        if (document.documentElement.lang === 'en') {
            setTimeout(translatePage, 100);
        }
    });
    
    // Special translation for forms and tables
    function translateFormsAndTables() {
        // Translate form labels
        document.querySelectorAll('label').forEach(label => {
            if (label.textContent && /[\u0600-\u06FF]/.test(label.textContent)) {
                const originalText = label.textContent.trim();
                const translatedText = translateText(originalText);
                if (translatedText !== originalText) {
                    label.textContent = translatedText;
                }
            }
        });
        
        // Translate table headers and cells
        document.querySelectorAll('th, td').forEach(cell => {
            if (cell.textContent && /[\u0600-\u06FF]/.test(cell.textContent)) {
                const originalText = cell.textContent.trim();
                const translatedText = translateText(originalText);
                if (translatedText !== originalText) {
                    cell.textContent = translatedText;
                }
            }
        });
        
        // Translate buttons
        document.querySelectorAll('button, .btn').forEach(btn => {
            if (btn.textContent && /[\u0600-\u06FF]/.test(btn.textContent)) {
                const originalText = btn.textContent.trim();
                const translatedText = translateText(originalText);
                if (translatedText !== originalText) {
                    btn.textContent = translatedText;
                }
            }
        });
        
        // Translate navigation items specifically
        document.querySelectorAll('.nav-link, .navbar-nav a, .sidebar a').forEach(navItem => {
            if (navItem.textContent && /[\u0600-\u06FF]/.test(navItem.textContent)) {
                const originalText = navItem.textContent.trim();
                const translatedText = translateText(originalText);
                if (translatedText !== originalText) {
                    navItem.textContent = translatedText;
                }
            }
        });
        
        // Translate breadcrumb items
        document.querySelectorAll('.breadcrumb-item').forEach(breadcrumb => {
            if (breadcrumb.textContent && /[\u0600-\u06FF]/.test(breadcrumb.textContent)) {
                const originalText = breadcrumb.textContent.trim();
                const translatedText = translateText(originalText);
                if (translatedText !== originalText) {
                    breadcrumb.textContent = translatedText;
                }
            }
        });
        
        // Translate card titles and text
        document.querySelectorAll('.card-title, .card-text, .card-header').forEach(cardElement => {
            if (cardElement.textContent && /[\u0600-\u06FF]/.test(cardElement.textContent)) {
                const originalText = cardElement.textContent.trim();
                const translatedText = translateText(originalText);
                if (translatedText !== originalText) {
                    cardElement.textContent = translatedText;
                }
            }
        });
        
        // Translate alerts and messages
        document.querySelectorAll('.alert, .message').forEach(alert => {
            if (alert.textContent && /[\u0600-\u06FF]/.test(alert.textContent)) {
                const originalText = alert.textContent.trim();
                const translatedText = translateText(originalText);
                if (translatedText !== originalText) {
                    alert.textContent = translatedText;
                }
            }
        });
    }
    
    // Run special translation for forms and tables
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(translateFormsAndTables, 300);
        setTimeout(translateFormsAndTables, 600);
        setTimeout(translateFormsAndTables, 1200);
        
        // Run special translation periodically
        setInterval(function() {
            if (document.documentElement.lang === 'en') {
                translateFormsAndTables();
            }
        }, 3000);
    });
    
    // Ultimate Comprehensive Translation System - Final Version
    
    // Force translate any remaining Arabic text - ENHANCED
    function forceTranslateAll() {
        if (document.documentElement.lang !== 'en') return;
        
        try {
            // Method 1: TreeWalker for all text nodes
            const allTextNodes = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        const parent = node.parentElement;
                        if (!parent || ['SCRIPT', 'STYLE', 'NOSCRIPT'].includes(parent.tagName)) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        const text = node.textContent.trim();
                        return text && /[\u0600-\u06FF]/.test(text) ? 
                            NodeFilter.FILTER_ACCEPT : 
                            NodeFilter.FILTER_REJECT;
                    }
                }
            );
            
            let textNode;
            while (textNode = allTextNodes.nextNode()) {
                const originalText = textNode.textContent.trim();
                if (originalText) {
                    const translatedText = translateText(originalText);
                    if (translatedText !== originalText) {
                        textNode.textContent = translatedText;
                    }
                }
            }
            
            // Method 2: Query all possible elements with Arabic content
            const allElements = document.querySelectorAll('*:not(script):not(style):not(noscript)');
            allElements.forEach(element => {
                if (element.textContent && 
                    /[\u0600-\u06FF]/.test(element.textContent) && 
                    element.children.length === 0) {
                    
                    const originalText = element.textContent.trim();
                    const translatedText = translateText(originalText);
                    if (translatedText !== originalText) {
                        element.textContent = translatedText;
                    }
                }
            });
            
        } catch (error) {
            console.log('Ultimate force translation error:', error);
        }
    }
    
    // Enhanced Final Translation Function
    function finalTranslationSweep() {
        if (document.documentElement.lang !== 'en') return;
        
        // Final comprehensive sweep of all text content
        const finalSelectors = [
            'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span', 'div', 'a', 'button', 
            'label', 'th', 'td', 'li', 'option', 'legend', 'caption', 'figcaption',
            '.nav-link', '.btn', '.form-label', '.card-title', '.card-text', '.alert',
            '.badge', '.breadcrumb-item', '.dropdown-item', '.list-group-item',
            '.tab-pane', '[data-bs-toggle]', '.modal-title', '.modal-body',
            '.toast-header', '.toast-body', '.accordion-header', '.accordion-body'
        ];
        
        finalSelectors.forEach(selector => {
            document.querySelectorAll(selector).forEach(element => {
                if (element.textContent && /[\u0600-\u06FF]/.test(element.textContent)) {
                    const hasOnlyTextOrIcon = element.children.length === 0 || 
                        (element.children.length === 1 && element.children[0].tagName === 'I' && 
                         element.children[0].classList.contains('fas'));
                        
                    if (hasOnlyTextOrIcon) {
                        const originalText = element.textContent.trim();
                        const translatedText = translateText(originalText);
                        if (translatedText !== originalText) {
                            if (element.children.length === 1 && element.children[0].tagName === 'I') {
                                const icon = element.children[0].outerHTML;
                                element.innerHTML = icon + ' ' + translatedText.replace(/^\s*/, '');
                            } else {
                                element.textContent = translatedText;
                            }
                        }
                    }
                }
            });
        });
        
        // Final attribute translation
        document.querySelectorAll('[placeholder], [title], [alt], [aria-label], [data-bs-title]').forEach(element => {
            ['placeholder', 'title', 'alt', 'aria-label', 'data-bs-title'].forEach(attr => {
                const value = element.getAttribute(attr);
                if (value && /[\u0600-\u06FF]/.test(value)) {
                    const translatedValue = translateText(value);
                    if (translatedValue !== value) {
                        element.setAttribute(attr, translatedValue);
                    }
                }
            });
        });
    }
    
    // Ultimate Translation Execution System - FIXED for Arabic Version
    document.addEventListener('DOMContentLoaded', function() {
        // CRITICAL: Only run translation in English version
        if (document.documentElement.lang !== 'en') {
            console.log('🌍 Arabic version detected - translation system disabled');
            return; // Exit immediately for Arabic version
        }
        
        console.log('🌍 English version detected - enabling translation system');
        
        // Defer translation to avoid blocking page rendering
        setTimeout(function() {
            // Initial translation with reduced frequency
            forceTranslateAll();
            finalTranslationSweep();
        }, 500);
        
        // Secondary phase - less aggressive
        setTimeout(function() {
            forceTranslateAll();
            finalTranslationSweep();
        }, 2000);
        
        // Final phase - only if needed
        setTimeout(function() {
            if (document.documentElement.lang === 'en') {
                forceTranslateAll();
                finalTranslationSweep();
                console.log('🌟 Ultimate Arabic translation completed! 🌟');
            }
        }, 5000);
        
        // Reduced monitoring frequency to improve performance
        setInterval(function() {
            if (document.documentElement.lang === 'en') {
                // Only run if there are untranslated Arabic texts
                const arabicTexts = document.querySelectorAll('*');
                let foundUntranslated = false;
                for (let i = 0; i < Math.min(arabicTexts.length, 50); i++) { // Limit check to first 50 elements
                    if (arabicTexts[i].textContent && /[\u0600-\u06FF]/.test(arabicTexts[i].textContent)) {
                        foundUntranslated = true;
                        break;
                    }
                }
                
                if (foundUntranslated) {
                    forceTranslateAll();
                    finalTranslationSweep();
                }
            }
        }, 10000); // Increased interval from 5s to 10s
    });
    
    {% endif %}
    </script>
    
    <!-- Responsive JavaScript -->
    <script src="{% static 'core/js/responsive.js' %}"></script>
    <script src="{% static 'core/js/table-responsive.js' %}"></script>
    
    <!-- Language Switching Enhancement -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // التعامل مع نماذج تبديل اللغة
        const languageForms = document.querySelectorAll('.language-form');
        languageForms.forEach(form => {
            form.addEventListener('submit', function(e) {
                // تحديد المسار الصحيح بناءً على اللغة المستهدفة
                const targetLang = this.dataset.targetLang;
                const nextField = this.querySelector('.next-field');
                const currentPath = nextField.value;
                
                // تحويل المسار إلى اللغة المستهدفة
                let newPath = currentPath;
                if (targetLang === 'ar') {
                    // التحويل إلى العربية
                    if (newPath.startsWith('/en/')) {
                        newPath = newPath.replace('/en/', '/ar/');
                    } else if (!newPath.startsWith('/ar/')) {
                        newPath = '/ar' + newPath;
                    }
                } else if (targetLang === 'en') {
                    // التحويل إلى الإنجليزية
                    if (newPath.startsWith('/ar/')) {
                        newPath = newPath.replace('/ar/', '/en/');
                    } else if (!newPath.startsWith('/en/')) {
                        newPath = '/en' + newPath;
                    }
                }
                
                // تحديث قيمة next
                nextField.value = newPath;
                
                // إضافة مؤشر تحميل
                const button = this.querySelector('button');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>جاري التبديل...';
                button.disabled = true;
                
                // التأكد من إرسال النموذج
                setTimeout(() => {
                    if (button.disabled) {
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }
                }, 3000);
            });
        });
    });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
