# ุฅุตูุงุญ ุญุณุงุจ ุงูุณุนุฑ ูู ุตูุญุงุช ุงูููุงุชูุฑ

## ๐ ุงูุชุงุฑูุฎ
**2025-10-10**

## ๐ฏ ุงููุดููุฉ
ูุงูุช ุตูุญุงุช ุฅุถุงูุฉ ูุชุนุฏูู ููุงุชูุฑ ุงููุจูุนุงุช ุชุญุณุจ ุงูุณุนุฑ ุจุทุฑููุฉ ูุฎุชููุฉ ุนู ุตูุญุฉ POSุ ููุง ูุณุจุจ ุนุฏู ุงุชุณุงู ูู ุงูุฃุณุนุงุฑ ุงููุนุฑูุถุฉ.

## ๐ ุงูุณุจุจ
- **ุณุนุฑ ุงูุจูุน ุงููุฎุฒู** ูู ุฌุฏูู ุงูููุชุฌุงุช (`sale_price`) ูู **ุดุงูู ููุถุฑูุจุฉ**
- ุตูุญุฉ **POS** ุชุณุชุฎุฏู API ุฎุงุต (`/sales/pos/product/{id}/`) ูููู ุจุฎุตู ุงูุถุฑูุจุฉ ุชููุงุฆูุงู
- ุตูุญุงุช **ุงูููุงุชูุฑ** ูุงูุช ุชุญุณุจ ุงูุณุนุฑ ูุญููุงู (ูู JavaScript) ุจุทุฑููุฉ ูุฒุฏูุฌุฉ ูุบูุฑ ูุชุณูุฉ

## โ ุงูุญู ุงููุทุจู

### 1. **ุตูุญุฉ ุฅุถุงูุฉ ุงููุงุชูุฑุฉ** (`templates/sales/invoice_add.html`)

#### **ูุจู ุงูุฅุตูุงุญ:**
```javascript
// ูุงู ูุญุณุจ ุงูุณุนุฑ ูุฑุชูู:
// 1. ูู ุงูููู ุงูููุฑุฑุฉ ูู template
const templateDisplayedPrice = salePrice / (1 + taxRate / 100);
applyPrice(templateDisplayedPrice, 'template');

// 2. ูู POS API
fetch(`/sales/pos/product/${productId}/`)
    .then(data => applyPrice(data.product.price, 'pos'));
```

#### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```javascript
// ุงูุขู ูุนุชูุฏ ููุท ุนูู POS API
priceInput.value = '...'; // ุฑุณุงูุฉ ุชุญููู
priceInput.disabled = true;

fetch(`/sales/pos/product/${productId}/`)
    .then(data => {
        priceInput.disabled = false;
        applyPrice(data.product.price, 'pos'); // ุงูุณุนุฑ ุจุฏูู ุถุฑูุจุฉ
        taxRateInput.value = data.product.tax_rate;
    });
```

### 2. **ุตูุญุฉ ุชุนุฏูู ุงููุงุชูุฑุฉ** (`templates/sales/invoice_edit.html`)

#### **ูุจู ุงูุฅุตูุงุญ:**
```javascript
// ูุงู ูุฃุฎุฐ ุงูุณุนุฑ ูุจุงุดุฑุฉ ูู data attribute (ุดุงูู ุงูุถุฑูุจุฉ)
$('#new-product-select').change(function() {
    const price = selectedOption.data('price'); // ุณุนุฑ ุดุงูู ุงูุถุฑูุจุฉ โ
    $('#new-price').val(price);
});
```

#### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```javascript
// ุงูุขู ูุณุชุฏุนู POS API
$('#new-product-select').change(function() {
    $.ajax({
        url: `/sales/pos/product/${productId}/`,
        success: function(data) {
            $('#new-price').val(data.product.price); // ุณุนุฑ ุจุฏูู ุถุฑูุจุฉ โ
            $('#new-tax-rate').val(data.product.tax_rate);
        }
    });
});
```

## ๐ ูุซุงู ุชูุถูุญู

### **ููุชุฌ ุจุณุนุฑ 110 ุฏููุงุฑ (ุดุงูู ุถุฑูุจุฉ 10%)**

| ุงูุตูุญุฉ | ูุจู ุงูุฅุตูุงุญ | ุจุนุฏ ุงูุฅุตูุงุญ |
|--------|-------------|--------------|
| **POS** | 100 ุฏููุงุฑ โ | 100 ุฏููุงุฑ โ |
| **ุฅุถุงูุฉ ูุงุชูุฑุฉ** | ~90.91 ุฃู 100 (ุบูุฑ ูุชุณู) โ | 100 ุฏููุงุฑ โ |
| **ุชุนุฏูู ูุงุชูุฑุฉ** | 110 ุฏููุงุฑ โ | 100 ุฏููุงุฑ โ |

### **ุญุณุงุจ ุงููุงุชูุฑุฉ:**
- **ุงูุณุนุฑ (ุจุฏูู ุถุฑูุจุฉ):** 100 ุฏููุงุฑ
- **ุงููููุฉ:** 2
- **ุงููุจูุบ ุงูุฌุฒุฆู:** 100 ร 2 = **200 ุฏููุงุฑ**
- **ุงูุถุฑูุจุฉ (10%):** 200 ร 0.10 = **20 ุฏููุงุฑ**
- **ุงูุฅุฌูุงูู:** **220 ุฏููุงุฑ**

## ๐ฏ ุงูููุงุฆุฏ

### 1. **ุงูุงุชุณุงู ุงูุชุงู:**
- โ ุฌููุน ุงูุตูุญุงุช ุชุณุชุฎุฏู ููุณ API
- โ ููุณ ุทุฑููุฉ ุญุณุงุจ ุงูุณุนุฑ ูุงูุถุฑูุจุฉ
- โ ูุชุงุฆุฌ ูุชุทุงุจูุฉ ูู ูู ููุงู

### 2. **ุงูููุซูููุฉ:**
- โ ูุตุฏุฑ ูุงุญุฏ ููุญูููุฉ (Single Source of Truth)
- โ ุงูุญุณุงุจ ูู Backend (ุขูู ููุฑูุฒู)
- โ ุชูููู ุงูุฃุฎุทุงุก ุงูุจุดุฑูุฉ

### 3. **ุงูุตูุงูุฉ:**
- โ ููุฏ ุฃุจุณุท ูุฃุณูู ููููู
- โ ุฅุฐุง ุชุบูุฑุช ุทุฑููุฉ ุงูุญุณุงุจุ ูููู ุชุนุฏูู ููุงู ูุงุญุฏ (ูู API)
- โ ุณูููุฉ ุงุฎุชุจุงุฑ ูุชุตุญูุญ ุงูุฃุฎุทุงุก

## ๐ง ุงููููุงุช ุงููุนุฏูุฉ

1. **templates/sales/invoice_add.html**
   - ุงูุณุทูุฑ: 965-1072
   - ุงูุชุนุฏูู: ุฏุงูุฉ `selectProduct()`

2. **templates/sales/invoice_edit.html**
   - ุงูุณุทูุฑ: 406-418
   - ุงูุชุนุฏูู: ูุนุงูุฌ `$('#new-product-select').change()`

## ๐ ููุงุญุธุงุช ูููุฉ

### **API ุงููุณุชุฎุฏู:**
```
GET /sales/pos/product/{product_id}/
```

**Response:**
```json
{
    "success": true,
    "product": {
        "id": 7,
        "name": "ููุชุฌ ุชุฌุฑูุจู",
        "price": 100.000,        // ุงูุณุนุฑ ุจุฏูู ุถุฑูุจุฉ โ
        "tax_rate": 10.00,
        "stock": 50.000,
        "barcode": "123456",
        "track_inventory": true
    }
}
```

### **ุงูุญุณุงุจ ูู Backend:**
```python
# ูู sales/views.py - ุฏุงูุฉ pos_get_product()
displayed_price = float(product.sale_price)  # 110 (ุดุงูู ุงูุถุฑูุจุฉ)
if tax_rate > 0:
    displayed_price = displayed_price / (1 + tax_rate / 100)  # 110 / 1.10 = 100
```

## โ ุงูุชุญูู ูู ุงูุฅุตูุงุญ

### **ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:**

1. **ุฅุถุงูุฉ ููุชุฌ ุจุณุนุฑ 110 ุฏููุงุฑ ูุถุฑูุจุฉ 10%**
2. **ูุชุญ ุตูุญุฉ POS** - ูุฌุจ ุฃู ูุธูุฑ ุงูุณุนุฑ: **100 ุฏููุงุฑ**
3. **ูุชุญ ุตูุญุฉ ุฅุถุงูุฉ ูุงุชูุฑุฉ** - ุงุฎุชูุงุฑ ููุณ ุงูููุชุฌ - ุงูุณุนุฑ: **100 ุฏููุงุฑ** โ
4. **ูุชุญ ุตูุญุฉ ุชุนุฏูู ูุงุชูุฑุฉ** - ุฅุถุงูุฉ ููุณ ุงูููุชุฌ - ุงูุณุนุฑ: **100 ุฏููุงุฑ** โ

### **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงูุณุนุฑ ูุชุทุงุจู ูู ุฌููุน ุงูุตูุญุงุช
- โ ุงูุถุฑูุจุฉ ุชูุญุณุจ ุจุดูู ุตุญูุญ
- โ ุงูุฅุฌูุงูู ุงูููุงุฆู ุตุญูุญ

## ๐ ุงูุฃูุงู ูุงูุฃุฏุงุก

### **ุงูุฃูุงู:**
- โ ุงูุญุณุงุจ ูู Backend (ูุง ูููู ุงูุชูุงุนุจ ุจู ูู ุงููุชุตูุญ)
- โ ุงุณุชุฎุฏุงู `credentials: 'same-origin'` ูู fetch
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู API

### **ุงูุฃุฏุงุก:**
- โ๏ธ ุงุณุชุฏุนุงุก ุฅุถุงูู ููู API (acceptable overhead)
- โ ูุชู Cache ูู ุงููุชุตูุญ
- โ ุฑุณุงูุฉ "ุชุญููู..." ุฃุซูุงุก ุงูุงูุชุธุงุฑ (UX ุฃูุถู)

## ๐ ูุนุงููุฑ IFRS ุฐุงุช ุงูุตูุฉ

- **IAS 18:** ุงูุฅูุฑุงุฏุงุช - ูุฌุจ ูุตู ุงูุณุนุฑ ุนู ุงูุถุฑูุจุฉ
- **IFRS 15:** ุงูุฅูุฑุงุฏ ูู ุงูุนููุฏ - ูุฌุจ ุนุฑุถ ุงูุณุนุฑ ูุงูุถุฑูุจุฉ ุจุดูู ูููุตู
- **ุงููุนุงููุฑ ุงููุญููุฉ:** ุฃุบูุจ ุงูุฏูู ุชุชุทูุจ ูุตู ุงูุถุฑูุจุฉ ูู ุงูููุงุชูุฑ

## ๐ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

1. **Single Source of Truth:** ุฏุงุฆูุงู ุงุณุชุฎุฏู ูุตุฏุฑ ูุงุญุฏ ููุจูุงูุงุช ุงูุญุฑุฌุฉ
2. **Backend Validation:** ุงูุญุณุงุจุงุช ุงููููุฉ ูุฌุจ ุฃู ุชููู ูู Backend
3. **Consistency:** ุงูุงุชุณุงู ุจูู ุงูุตูุญุงุช ุฃูู ูู ุงูุฃุฏุงุก ูู ูุซูุฑ ูู ุงูุญุงูุงุช
4. **User Feedback:** ุฑุณุงุฆู ุงูุชุญููู ุชุญุณู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุญุชู ูู ูุงู ุงูุงูุชุธุงุฑ ูุตูุฑ

---

**ุชู ุงูุชูุซูู ุจูุงุณุทุฉ:** GitHub Copilot  
**ุงููุฑุงุฌุนุฉ:** ูุทููุจุฉ ูู ูุฑูู ุงูุชุทููุฑ  
**ุงูุญุงูุฉ:** โ ููุชูู ููุทุจู
