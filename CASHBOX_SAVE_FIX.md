# ุฏููู ุฅุตูุงุญ ูุดููุฉ ุงูุตูุฏูู ุนูู ุงูุฎุงุฏู ุงููุจุงุดุฑ

## ุงููุดููุฉ
ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช ููุฏูุฉ ูุงุฎุชูุงุฑ ุตูุฏููุ ูุง ูุชู ุญูุธ ุงูุตูุฏูู ุงูููุฎุชุงุฑ.

## ุงูุณุจุจ
ุงูุณูุฌูุงู `create_cashbox_transaction_for_sales` ูู ููู `sales/signals.py` ูุงู ูุชุฌุงูู ุงูุตูุฏูู ุงูููุฎุชุงุฑ ููุณุชุจุฏูู ุจุตูุฏูู ุขุฎุฑ.

## ุงูุญู
ุชุนุฏูู ุงูุณุทุฑ 11 ูู ููู `sales/signals.py`:

### ูุจู ุงูุชุนุฏูู:
```python
# ุชุญุฏูุฏ ุงูุตูุฏูู ุงูููุงุณุจ
cashbox = None

# ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุชุทูุน ุงููุตูู ูููุทุฉ ุงูุจูุนุ ุงุณุชุฎุฏู ุตูุฏููู ุงูุฎุงุต
if instance.created_by.has_perm('users.can_access_pos'):
    ...
```

### ุจุนุฏ ุงูุชุนุฏูู:
```python
# ๐ง ุงุณุชุฎุฏุงู ุงูุตูุฏูู ุงููุญุฏุฏ ูู ุงููุงุชูุฑุฉ ุฃููุงู (ุฅู ููุฌุฏ)
cashbox = instance.cashbox

# ุฅุฐุง ูู ููู ููุงู ุตูุฏูู ูุญุฏุฏุ ุญุฏุฏ ูุงุญุฏ ุญุณุจ ุงููุณุชุฎุฏู
if not cashbox:
    # ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุชุทูุน ุงููุตูู ูููุทุฉ ุงูุจูุนุ ุงุณุชุฎุฏู ุตูุฏููู ุงูุฎุงุต
    if instance.created_by.has_perm('users.can_access_pos'):
        ...
```

---

## ุฎุทูุงุช ุงูุชุทุจูู ุนูู ุงูุฎุงุฏู

### ุงูุทุฑููุฉ 1: ุนุจุฑ SSH (ุงูุฃุณุฑุน)

```bash
# 1. ุงุชุตู ุจุงูุฎุงุฏู
ssh username@your-server.com

# 2. ุงูุชูู ููุฌูุฏ ุงููุดุฑูุน
cd /path/to/finspilot

# 3. ุงูุชุญ ููู signals.py
nano sales/signals.py

# 4. ุงุจุญุซ ุนู ุงูุณุทุฑ 11 (ูู ุฏุงูุฉ create_cashbox_transaction_for_sales)
# ุงุถุบุท Ctrl+W ุซู ุงูุชุจ: ุชุญุฏูุฏ ุงูุตูุฏูู ุงูููุงุณุจ

# 5. ุงุณุชุจุฏู ุงูุฃุณุทุฑ 11-14 ุจุงูููุฏ ุงูุฌุฏูุฏ:
#    ูุจู:
#        # ุชุญุฏูุฏ ุงูุตูุฏูู ุงูููุงุณุจ
#        cashbox = None
#        
#        # ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุชุทูุน ุงููุตูู ูููุทุฉ ุงูุจูุนุ ุงุณุชุฎุฏู ุตูุฏููู ุงูุฎุงุต
#        if instance.created_by.has_perm('users.can_access_pos'):
#
#    ุจุนุฏ:
#        # ๐ง ุงุณุชุฎุฏุงู ุงูุตูุฏูู ุงููุญุฏุฏ ูู ุงููุงุชูุฑุฉ ุฃููุงู (ุฅู ููุฌุฏ)
#        cashbox = instance.cashbox
#        
#        # ุฅุฐุง ูู ููู ููุงู ุตูุฏูู ูุญุฏุฏุ ุญุฏุฏ ูุงุญุฏ ุญุณุจ ุงููุณุชุฎุฏู
#        if not cashbox:
#            # ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุชุทูุน ุงููุตูู ูููุทุฉ ุงูุจูุนุ ุงุณุชุฎุฏู ุตูุฏููู ุงูุฎุงุต
#            if instance.created_by.has_perm('users.can_access_pos'):

# 6. ุงุญูุธ ุงูููู
#    ุงุถุบุท Ctrl+O ุซู Enter ุซู Ctrl+X

# 7. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู
sudo systemctl restart gunicorn
# ุฃู
sudo systemctl restart finspilot
```

---

### ุงูุทุฑููุฉ 2: ุนุจุฑ Django Shell (ุฅุฐุง ูู ูุชููุฑ ูุญุฑุฑ ูุตูุต)

ูุฐู ุงูุทุฑููุฉ ุชุนุฏู ุงูููู ุจุฑูุฌูุงู:

```bash
# 1. ุงูุชุญ Django Shell
python manage.py shell

# 2. ุงูุณุฎ ูุงูุตู ุงูููุฏ ุงูุชุงูู:
```

```python
# ูุฑุงุกุฉ ุงูููู
file_path = 'sales/signals.py'
with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()

# ุงูุจุญุซ ูุงูุงุณุชุจุฏุงู
old_code = '''        # ุงูุชุญูู ูู ุฃู ุงููุงุชูุฑุฉ ุฌุฏูุฏุฉ ูููุฏูุฉ
        if created and instance.payment_type == 'cash' and instance.total_amount > 0:
            # ุชุญุฏูุฏ ุงูุตูุฏูู ุงูููุงุณุจ
            cashbox = None
            
            # ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุชุทูุน ุงููุตูู ูููุทุฉ ุงูุจูุนุ ุงุณุชุฎุฏู ุตูุฏููู ุงูุฎุงุต
            if instance.created_by.has_perm('users.can_access_pos'):'''

new_code = '''        # ุงูุชุญูู ูู ุฃู ุงููุงุชูุฑุฉ ุฌุฏูุฏุฉ ูููุฏูุฉ
        if created and instance.payment_type == 'cash' and instance.total_amount > 0:
            # ๐ง ุงุณุชุฎุฏุงู ุงูุตูุฏูู ุงููุญุฏุฏ ูู ุงููุงุชูุฑุฉ ุฃููุงู (ุฅู ููุฌุฏ)
            cashbox = instance.cashbox
            
            # ุฅุฐุง ูู ููู ููุงู ุตูุฏูู ูุญุฏุฏุ ุญุฏุฏ ูุงุญุฏ ุญุณุจ ุงููุณุชุฎุฏู
            if not cashbox:
                # ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุชุทูุน ุงููุตูู ูููุทุฉ ุงูุจูุนุ ุงุณุชุฎุฏู ุตูุฏููู ุงูุฎุงุต
                if instance.created_by.has_perm('users.can_access_pos'):'''

# ุชูููุฐ ุงูุงุณุชุจุฏุงู
if old_code in content:
    content = content.replace(old_code, new_code)
    
    # ุญูุธ ุงูููู
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("โ ุชู ุชุนุฏูู ุงูููู ุจูุฌุงุญ!")
else:
    print("โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุฏ ุงููุฏูู")

# ุงูุฎุฑูุฌ
exit()
```

```bash
# 3. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู
sudo systemctl restart gunicorn
```

---

### ุงูุทุฑููุฉ 3: ุนุจุฑ SFTP (ุจุฏูู SSH)

1. **ุญููู ููู `sales/signals.py`** ูู ุงูุฎุงุฏู ุฅูู ุฌูุงุฒู
2. **ุงูุชุญู ูู ูุญุฑุฑ ูุตูุต** (VS Code, Notepad++, etc)
3. **ุงุจุญุซ ุนู ุงูุณุทุฑ 11** ูุนุฏููู ููุง ูู ุงูุฃุนูู
4. **ุงุฑูุน ุงูููู ุงูููุนุฏูู** ุฅูู ุงูุฎุงุฏู (ุงุณุชุจุฏู ุงููุฏูู)
5. **ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู** ุนุจุฑ ููุญุฉ ุงูุชุญูู

---

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญ

ุจุนุฏ ุชุทุจูู ุงูุฅุตูุงุญ:

1. โ ุงูุชุญ ุตูุญุฉ ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช
2. โ ุงุฎุชุฑ "ููุฏุงู" ูุทุฑููุฉ ุงูุฏูุน
3. โ ุงุฎุชุฑ ุตูุฏูู ููุฏู ูุญุฏุฏ
4. โ ุฃูุดุฆ ุงููุงุชูุฑุฉ
5. โ ุงูุชุญ ุตูุญุฉ ูุงุฆูุฉ ุงูููุงุชูุฑ
6. โ ุชุฃูุฏ ูู ุธููุฑ ุงุณู ุงูุตูุฏูู ุงูููุฎุชุงุฑ (ูููุณ "โ๏ธ ุบูุฑ ูุญุฏุฏ")
7. โ ุงูุชุญ ุตูุญุฉ ุชูุงุฑูุฑ ุงูุตูุงุฏูู
8. โ ุชุฃูุฏ ูู ุฃู ุงููุจูุบ ุฃูุถูู ููุตูุฏูู ุงูุตุญูุญ

---

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ูุจู ุงูุชุทุจูู:**
- ุงุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ููู `sales/signals.py`
- ููุถู ุงูุชุทุจูู ูู ููุช ูููู ุงูุงุณุชุฎุฏุงู

โ **ุจุนุฏ ุงูุชุทุจูู:**
- ุงูููุงุชูุฑ ุงูุฌุฏูุฏุฉ ุณุชูุญูุธ ุจุงูุตูุฏูู ุงูููุฎุชุงุฑ
- ุงูููุงุชูุฑ ุงููุฏููุฉ ูููู ุฅุตูุงุญูุง ุจุณูุฑูุจุช `fix_remote_cash_invoices.py`
- ูุง ุญุงุฌุฉ ูุฃู ุฅุฌุฑุงุก ูู ุงููุณุชุฎุฏููู

---

## ุงููุฑู ุงูุฏููู

ุงููุฑู ุงููุญูุฏ ูู ุฅุถุงูุฉ **3 ุฃุณุทุฑ**:

```python
# ๐ง ุงุณุชุฎุฏุงู ุงูุตูุฏูู ุงููุญุฏุฏ ูู ุงููุงุชูุฑุฉ ุฃููุงู (ุฅู ููุฌุฏ)
cashbox = instance.cashbox

# ุฅุฐุง ูู ููู ููุงู ุตูุฏูู ูุญุฏุฏุ ุญุฏุฏ ูุงุญุฏ ุญุณุจ ุงููุณุชุฎุฏู
if not cashbox:
```

ูุฐุง ูุฌุนู ุงูุณูุฌูุงู ูุญุชุฑู ุงูุตูุฏูู ุงูููุฎุชุงุฑ ูู ุงููุณุชุฎุฏู ุจุฏูุงู ูู ุชุฌุงููู.

---

## ุงููููุงุช ุงูููุนุฏููุฉ

- โ `sales/signals.py` (ุงูุณุทูุฑ 11-14)

ูุง ุชูุฌุฏ ูููุงุช ุฃุฎุฑู ุชุญุชุงุฌ ุชุนุฏูู.
